<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>【摘录】相机位姿估计相关代码解读 | Yin的笔记本</title>
    <meta name="generator" content="VuePress 1.5.0">
    <link rel="icon" href="/favicon.ico">
    <link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css">
    <link rel="stylesheet" href="https://fastly.jsdelivr.net/github-markdown-css/2.2.1/github-markdown.css">
    <meta name="description" content="Yin的笔记本">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    <link rel="preload" href="/assets/css/0.styles.2d94763a.css" as="style"><link rel="preload" href="/assets/js/app.1c89d7eb.js" as="script"><link rel="preload" href="/assets/js/3.63b8c0eb.js" as="script"><link rel="preload" href="/assets/js/1.be3d2055.js" as="script"><link rel="preload" href="/assets/js/195.f41818b6.js" as="script"><link rel="prefetch" href="/assets/js/10.7997888a.js"><link rel="prefetch" href="/assets/js/100.2278e289.js"><link rel="prefetch" href="/assets/js/101.12c66a26.js"><link rel="prefetch" href="/assets/js/102.6468aee3.js"><link rel="prefetch" href="/assets/js/103.d1dd7048.js"><link rel="prefetch" href="/assets/js/104.f4890013.js"><link rel="prefetch" href="/assets/js/105.a97deef5.js"><link rel="prefetch" href="/assets/js/106.c1bcc835.js"><link rel="prefetch" href="/assets/js/107.03ab02e9.js"><link rel="prefetch" href="/assets/js/108.ce9a9508.js"><link rel="prefetch" href="/assets/js/109.d03fd13e.js"><link rel="prefetch" href="/assets/js/11.f5bd6d01.js"><link rel="prefetch" href="/assets/js/110.13c311a4.js"><link rel="prefetch" href="/assets/js/111.6f30518f.js"><link rel="prefetch" href="/assets/js/112.ca951fb9.js"><link rel="prefetch" href="/assets/js/113.9c5c0582.js"><link rel="prefetch" href="/assets/js/114.eb24eb1a.js"><link rel="prefetch" href="/assets/js/115.de265fa2.js"><link rel="prefetch" href="/assets/js/116.24745fa4.js"><link rel="prefetch" href="/assets/js/117.86d4e841.js"><link rel="prefetch" href="/assets/js/118.9dbd6211.js"><link rel="prefetch" href="/assets/js/119.d8ec6ee3.js"><link rel="prefetch" href="/assets/js/12.770bcdd1.js"><link rel="prefetch" href="/assets/js/120.21b9b7e4.js"><link rel="prefetch" href="/assets/js/121.69c915c7.js"><link rel="prefetch" href="/assets/js/122.ddedddba.js"><link rel="prefetch" href="/assets/js/123.5a80347b.js"><link rel="prefetch" href="/assets/js/124.71bff2da.js"><link rel="prefetch" href="/assets/js/125.21830b23.js"><link rel="prefetch" href="/assets/js/126.f30185cf.js"><link rel="prefetch" href="/assets/js/127.3aeb1f53.js"><link rel="prefetch" href="/assets/js/128.6c296bf9.js"><link rel="prefetch" href="/assets/js/129.fda4528b.js"><link rel="prefetch" href="/assets/js/13.070330f5.js"><link rel="prefetch" href="/assets/js/130.9e6b67b0.js"><link rel="prefetch" href="/assets/js/131.20b0e822.js"><link rel="prefetch" href="/assets/js/132.a35815d1.js"><link rel="prefetch" href="/assets/js/133.bfa0daa0.js"><link rel="prefetch" href="/assets/js/134.eaea7aba.js"><link rel="prefetch" href="/assets/js/135.3a5c98a8.js"><link rel="prefetch" href="/assets/js/136.01223e0d.js"><link rel="prefetch" href="/assets/js/137.7cce857f.js"><link rel="prefetch" href="/assets/js/138.7a586d88.js"><link rel="prefetch" href="/assets/js/139.3f8891f1.js"><link rel="prefetch" href="/assets/js/14.760d4ae9.js"><link rel="prefetch" href="/assets/js/140.7d36bb0c.js"><link rel="prefetch" href="/assets/js/141.b2a3eaa6.js"><link rel="prefetch" href="/assets/js/142.8765938e.js"><link rel="prefetch" href="/assets/js/143.877037ca.js"><link rel="prefetch" href="/assets/js/144.0c63859f.js"><link rel="prefetch" href="/assets/js/145.0826322f.js"><link rel="prefetch" href="/assets/js/146.0c7793ea.js"><link rel="prefetch" href="/assets/js/147.208c0c3d.js"><link rel="prefetch" href="/assets/js/148.e7e56ea0.js"><link rel="prefetch" href="/assets/js/149.269f672b.js"><link rel="prefetch" href="/assets/js/15.6dd745f8.js"><link rel="prefetch" href="/assets/js/150.5b335113.js"><link rel="prefetch" href="/assets/js/151.98e0c301.js"><link rel="prefetch" href="/assets/js/152.b8f48d96.js"><link rel="prefetch" href="/assets/js/153.bfeb3233.js"><link rel="prefetch" href="/assets/js/154.60508725.js"><link rel="prefetch" href="/assets/js/155.b8a1e762.js"><link rel="prefetch" href="/assets/js/156.a002dc45.js"><link rel="prefetch" href="/assets/js/157.5e547455.js"><link rel="prefetch" href="/assets/js/158.d2f2e77b.js"><link rel="prefetch" href="/assets/js/159.200ec9a4.js"><link rel="prefetch" href="/assets/js/16.6860f890.js"><link rel="prefetch" href="/assets/js/160.c842c71c.js"><link rel="prefetch" href="/assets/js/161.b69b41de.js"><link rel="prefetch" href="/assets/js/162.abaa0820.js"><link rel="prefetch" href="/assets/js/163.781d45a1.js"><link rel="prefetch" href="/assets/js/164.489c9172.js"><link rel="prefetch" href="/assets/js/165.4001e6a3.js"><link rel="prefetch" href="/assets/js/166.f605c3b7.js"><link rel="prefetch" href="/assets/js/167.187f7fef.js"><link rel="prefetch" href="/assets/js/168.8e751948.js"><link rel="prefetch" href="/assets/js/169.5c50b84f.js"><link rel="prefetch" href="/assets/js/17.96a61fae.js"><link rel="prefetch" href="/assets/js/170.c145b06c.js"><link rel="prefetch" href="/assets/js/171.1ff621e6.js"><link rel="prefetch" href="/assets/js/172.b5012bca.js"><link rel="prefetch" href="/assets/js/173.5bfa26a7.js"><link rel="prefetch" href="/assets/js/174.09fa2f55.js"><link rel="prefetch" href="/assets/js/175.d9227914.js"><link rel="prefetch" href="/assets/js/176.00adae9b.js"><link rel="prefetch" href="/assets/js/177.919b9f47.js"><link rel="prefetch" href="/assets/js/178.7e815bb2.js"><link rel="prefetch" href="/assets/js/179.7abd2d00.js"><link rel="prefetch" href="/assets/js/18.e9d7c71b.js"><link rel="prefetch" href="/assets/js/180.655d5d4a.js"><link rel="prefetch" href="/assets/js/181.b46b1de0.js"><link rel="prefetch" href="/assets/js/182.2e8f1a2a.js"><link rel="prefetch" href="/assets/js/183.22265de0.js"><link rel="prefetch" href="/assets/js/184.74507e51.js"><link rel="prefetch" href="/assets/js/185.bfa1144d.js"><link rel="prefetch" href="/assets/js/186.823452a1.js"><link rel="prefetch" href="/assets/js/187.4d75455f.js"><link rel="prefetch" href="/assets/js/188.916ab9d4.js"><link rel="prefetch" href="/assets/js/189.add9f2bf.js"><link rel="prefetch" href="/assets/js/19.f46a344f.js"><link rel="prefetch" href="/assets/js/190.193af7ee.js"><link rel="prefetch" href="/assets/js/191.30e19787.js"><link rel="prefetch" href="/assets/js/192.485b0912.js"><link rel="prefetch" href="/assets/js/193.ec31135d.js"><link rel="prefetch" href="/assets/js/194.b6f1ea36.js"><link rel="prefetch" href="/assets/js/196.3997fb55.js"><link rel="prefetch" href="/assets/js/197.9316466e.js"><link rel="prefetch" href="/assets/js/198.d6eaf8d5.js"><link rel="prefetch" href="/assets/js/199.7833a5cf.js"><link rel="prefetch" href="/assets/js/20.3e59b7db.js"><link rel="prefetch" href="/assets/js/200.09ac4b4c.js"><link rel="prefetch" href="/assets/js/201.c181d266.js"><link rel="prefetch" href="/assets/js/202.0c17f434.js"><link rel="prefetch" href="/assets/js/203.f325f13a.js"><link rel="prefetch" href="/assets/js/204.cc6ab889.js"><link rel="prefetch" href="/assets/js/205.5dea103e.js"><link rel="prefetch" href="/assets/js/206.d4bed4f0.js"><link rel="prefetch" href="/assets/js/207.570e9c30.js"><link rel="prefetch" href="/assets/js/208.15c57dde.js"><link rel="prefetch" href="/assets/js/209.052fb626.js"><link rel="prefetch" href="/assets/js/21.0d860ace.js"><link rel="prefetch" href="/assets/js/210.17da69e7.js"><link rel="prefetch" href="/assets/js/211.0437b47a.js"><link rel="prefetch" href="/assets/js/212.6d3516a5.js"><link rel="prefetch" href="/assets/js/213.2016ed1e.js"><link rel="prefetch" href="/assets/js/214.8d375069.js"><link rel="prefetch" href="/assets/js/215.6895df63.js"><link rel="prefetch" href="/assets/js/216.c044b620.js"><link rel="prefetch" href="/assets/js/217.1ff7a370.js"><link rel="prefetch" href="/assets/js/218.2b5c6610.js"><link rel="prefetch" href="/assets/js/219.3d1b7c68.js"><link rel="prefetch" href="/assets/js/22.395f0662.js"><link rel="prefetch" href="/assets/js/220.2f7d0eb4.js"><link rel="prefetch" href="/assets/js/221.0d5c483a.js"><link rel="prefetch" href="/assets/js/222.b4e8edd9.js"><link rel="prefetch" href="/assets/js/223.ed8cd7c5.js"><link rel="prefetch" href="/assets/js/224.70f8536d.js"><link rel="prefetch" href="/assets/js/225.877f00f4.js"><link rel="prefetch" href="/assets/js/226.e6433587.js"><link rel="prefetch" href="/assets/js/227.57bea06d.js"><link rel="prefetch" href="/assets/js/228.46f056e8.js"><link rel="prefetch" href="/assets/js/229.e075c130.js"><link rel="prefetch" href="/assets/js/23.918096ae.js"><link rel="prefetch" href="/assets/js/230.513baab1.js"><link rel="prefetch" href="/assets/js/231.107ef86e.js"><link rel="prefetch" href="/assets/js/232.498787e8.js"><link rel="prefetch" href="/assets/js/233.c9c37e3d.js"><link rel="prefetch" href="/assets/js/234.3205c614.js"><link rel="prefetch" href="/assets/js/235.6e73d096.js"><link rel="prefetch" href="/assets/js/236.1cd1beda.js"><link rel="prefetch" href="/assets/js/237.4708c31e.js"><link rel="prefetch" href="/assets/js/238.8e5fe2c7.js"><link rel="prefetch" href="/assets/js/239.d6960886.js"><link rel="prefetch" href="/assets/js/24.191c578f.js"><link rel="prefetch" href="/assets/js/240.ac10844d.js"><link rel="prefetch" href="/assets/js/241.d176cd12.js"><link rel="prefetch" href="/assets/js/242.05602258.js"><link rel="prefetch" href="/assets/js/243.04d4eea2.js"><link rel="prefetch" href="/assets/js/244.666552a4.js"><link rel="prefetch" href="/assets/js/245.391a0ebb.js"><link rel="prefetch" href="/assets/js/246.bbc73f23.js"><link rel="prefetch" href="/assets/js/247.2fb1308f.js"><link rel="prefetch" href="/assets/js/248.cb32facb.js"><link rel="prefetch" href="/assets/js/249.8f2c20c3.js"><link rel="prefetch" href="/assets/js/25.9fa7a0f1.js"><link rel="prefetch" href="/assets/js/250.aee82d40.js"><link rel="prefetch" href="/assets/js/251.b27f9949.js"><link rel="prefetch" href="/assets/js/252.0d3a1c08.js"><link rel="prefetch" href="/assets/js/253.dbac77db.js"><link rel="prefetch" href="/assets/js/254.daeb0894.js"><link rel="prefetch" href="/assets/js/255.9ae341b8.js"><link rel="prefetch" href="/assets/js/256.0914df92.js"><link rel="prefetch" href="/assets/js/257.17692151.js"><link rel="prefetch" href="/assets/js/258.6a51affa.js"><link rel="prefetch" href="/assets/js/259.cfa1b7e2.js"><link rel="prefetch" href="/assets/js/26.977b91ed.js"><link rel="prefetch" href="/assets/js/260.01a0a834.js"><link rel="prefetch" href="/assets/js/261.7c6786a8.js"><link rel="prefetch" href="/assets/js/262.40aa6ec8.js"><link rel="prefetch" href="/assets/js/263.9b768341.js"><link rel="prefetch" href="/assets/js/264.3516b6ee.js"><link rel="prefetch" href="/assets/js/265.24ebac38.js"><link rel="prefetch" href="/assets/js/266.d0f18960.js"><link rel="prefetch" href="/assets/js/267.cb67bfa7.js"><link rel="prefetch" href="/assets/js/268.49a739ea.js"><link rel="prefetch" href="/assets/js/269.319f9495.js"><link rel="prefetch" href="/assets/js/27.cbf02bc2.js"><link rel="prefetch" href="/assets/js/270.0ab89f8c.js"><link rel="prefetch" href="/assets/js/271.5ebfdaad.js"><link rel="prefetch" href="/assets/js/272.d978c09e.js"><link rel="prefetch" href="/assets/js/273.c2ca9559.js"><link rel="prefetch" href="/assets/js/274.ef3c0b4e.js"><link rel="prefetch" href="/assets/js/275.0cb280a9.js"><link rel="prefetch" href="/assets/js/276.f01bb24d.js"><link rel="prefetch" href="/assets/js/277.4336236b.js"><link rel="prefetch" href="/assets/js/278.91b80a10.js"><link rel="prefetch" href="/assets/js/279.a3dba48a.js"><link rel="prefetch" href="/assets/js/28.ea6f85eb.js"><link rel="prefetch" href="/assets/js/280.28c7e56d.js"><link rel="prefetch" href="/assets/js/281.b40bcb2f.js"><link rel="prefetch" href="/assets/js/282.8b95f9c1.js"><link rel="prefetch" href="/assets/js/283.112bae13.js"><link rel="prefetch" href="/assets/js/284.32679d92.js"><link rel="prefetch" href="/assets/js/285.5d940ba6.js"><link rel="prefetch" href="/assets/js/286.7644400d.js"><link rel="prefetch" href="/assets/js/287.3e55ea4a.js"><link rel="prefetch" href="/assets/js/288.e008719f.js"><link rel="prefetch" href="/assets/js/289.288c8559.js"><link rel="prefetch" href="/assets/js/29.09e2943e.js"><link rel="prefetch" href="/assets/js/290.5e886e4a.js"><link rel="prefetch" href="/assets/js/291.317a7f21.js"><link rel="prefetch" href="/assets/js/292.8e9221de.js"><link rel="prefetch" href="/assets/js/293.d2e72c3b.js"><link rel="prefetch" href="/assets/js/294.b08bb0a5.js"><link rel="prefetch" href="/assets/js/295.0ff3e8b8.js"><link rel="prefetch" href="/assets/js/296.8db2437f.js"><link rel="prefetch" href="/assets/js/297.df969d5b.js"><link rel="prefetch" href="/assets/js/298.5e04335e.js"><link rel="prefetch" href="/assets/js/299.30af4295.js"><link rel="prefetch" href="/assets/js/30.8ce7bb1c.js"><link rel="prefetch" href="/assets/js/300.bbee17de.js"><link rel="prefetch" href="/assets/js/301.658e30a9.js"><link rel="prefetch" href="/assets/js/302.83a48594.js"><link rel="prefetch" href="/assets/js/303.25b5c5d0.js"><link rel="prefetch" href="/assets/js/304.d1cda2a7.js"><link rel="prefetch" href="/assets/js/305.ec45274c.js"><link rel="prefetch" href="/assets/js/306.f5481c32.js"><link rel="prefetch" href="/assets/js/307.477c6cfe.js"><link rel="prefetch" href="/assets/js/308.2fc60e29.js"><link rel="prefetch" href="/assets/js/309.d3153724.js"><link rel="prefetch" href="/assets/js/31.9a171aa4.js"><link rel="prefetch" href="/assets/js/310.cd447685.js"><link rel="prefetch" href="/assets/js/311.aa55b174.js"><link rel="prefetch" href="/assets/js/312.975cb9f5.js"><link rel="prefetch" href="/assets/js/313.ff1ed35d.js"><link rel="prefetch" href="/assets/js/314.0f909559.js"><link rel="prefetch" href="/assets/js/315.db32db01.js"><link rel="prefetch" href="/assets/js/32.947f503d.js"><link rel="prefetch" href="/assets/js/33.59e6f3ca.js"><link rel="prefetch" href="/assets/js/34.d611cc6b.js"><link rel="prefetch" href="/assets/js/35.1bcf17ab.js"><link rel="prefetch" href="/assets/js/36.4ce4f82a.js"><link rel="prefetch" href="/assets/js/37.0054f8c4.js"><link rel="prefetch" href="/assets/js/38.b4bdef00.js"><link rel="prefetch" href="/assets/js/39.436a4cf2.js"><link rel="prefetch" href="/assets/js/4.71970d79.js"><link rel="prefetch" href="/assets/js/40.3c0f9211.js"><link rel="prefetch" href="/assets/js/41.db84a37b.js"><link rel="prefetch" href="/assets/js/42.d490b527.js"><link rel="prefetch" href="/assets/js/43.53ff8034.js"><link rel="prefetch" href="/assets/js/44.6ac3003e.js"><link rel="prefetch" href="/assets/js/45.c5e657d2.js"><link rel="prefetch" href="/assets/js/46.9c37bbc9.js"><link rel="prefetch" href="/assets/js/47.8cc0235f.js"><link rel="prefetch" href="/assets/js/48.46917f1a.js"><link rel="prefetch" href="/assets/js/49.4956c196.js"><link rel="prefetch" href="/assets/js/5.b5c477bb.js"><link rel="prefetch" href="/assets/js/50.c350ef1e.js"><link rel="prefetch" href="/assets/js/51.228f9fb4.js"><link rel="prefetch" href="/assets/js/52.d0ea8325.js"><link rel="prefetch" href="/assets/js/53.bcf8531d.js"><link rel="prefetch" href="/assets/js/54.823cdd86.js"><link rel="prefetch" href="/assets/js/55.dd739e97.js"><link rel="prefetch" href="/assets/js/56.0a6fa41e.js"><link rel="prefetch" href="/assets/js/57.e8c7ac20.js"><link rel="prefetch" href="/assets/js/58.9a6ccc24.js"><link rel="prefetch" href="/assets/js/59.a3e64ba9.js"><link rel="prefetch" href="/assets/js/6.8d75c7c7.js"><link rel="prefetch" href="/assets/js/60.4ef57d04.js"><link rel="prefetch" href="/assets/js/61.b2221af0.js"><link rel="prefetch" href="/assets/js/62.d5e651a6.js"><link rel="prefetch" href="/assets/js/63.7cf7bbf5.js"><link rel="prefetch" href="/assets/js/64.a1b2ab5f.js"><link rel="prefetch" href="/assets/js/65.795f8ce1.js"><link rel="prefetch" href="/assets/js/66.766bae3c.js"><link rel="prefetch" href="/assets/js/67.33fffa58.js"><link rel="prefetch" href="/assets/js/68.34cad213.js"><link rel="prefetch" href="/assets/js/69.44ab1539.js"><link rel="prefetch" href="/assets/js/7.c826a528.js"><link rel="prefetch" href="/assets/js/70.0b157f44.js"><link rel="prefetch" href="/assets/js/71.dda3257f.js"><link rel="prefetch" href="/assets/js/72.e4fd59e4.js"><link rel="prefetch" href="/assets/js/73.5bfac475.js"><link rel="prefetch" href="/assets/js/74.106dce7c.js"><link rel="prefetch" href="/assets/js/75.febe432a.js"><link rel="prefetch" href="/assets/js/76.9d7b680c.js"><link rel="prefetch" href="/assets/js/77.53d02bdd.js"><link rel="prefetch" href="/assets/js/78.78f8bd3e.js"><link rel="prefetch" href="/assets/js/79.765020db.js"><link rel="prefetch" href="/assets/js/8.94c271b3.js"><link rel="prefetch" href="/assets/js/80.58708562.js"><link rel="prefetch" href="/assets/js/81.b496be82.js"><link rel="prefetch" href="/assets/js/82.e7fb031b.js"><link rel="prefetch" href="/assets/js/83.9a97b3c4.js"><link rel="prefetch" href="/assets/js/84.46388e53.js"><link rel="prefetch" href="/assets/js/85.273a246a.js"><link rel="prefetch" href="/assets/js/86.0f1a102d.js"><link rel="prefetch" href="/assets/js/87.0340887c.js"><link rel="prefetch" href="/assets/js/88.2464434e.js"><link rel="prefetch" href="/assets/js/89.9c7259c6.js"><link rel="prefetch" href="/assets/js/9.13823324.js"><link rel="prefetch" href="/assets/js/90.fc961b8c.js"><link rel="prefetch" href="/assets/js/91.05ce823e.js"><link rel="prefetch" href="/assets/js/92.6f598c32.js"><link rel="prefetch" href="/assets/js/93.9b4a4e9b.js"><link rel="prefetch" href="/assets/js/94.e181fada.js"><link rel="prefetch" href="/assets/js/95.1f019ce8.js"><link rel="prefetch" href="/assets/js/96.c5fdf710.js"><link rel="prefetch" href="/assets/js/97.64f5f96a.js"><link rel="prefetch" href="/assets/js/98.e761ab9f.js"><link rel="prefetch" href="/assets/js/99.b19b68c9.js">
    <link rel="stylesheet" href="/assets/css/0.styles.2d94763a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-42dd5e05><div data-v-42dd5e05><div id="loader-wrapper" class="loading-wrapper" data-v-d48f4d20 data-v-42dd5e05 data-v-42dd5e05><div class="loader-main" data-v-d48f4d20><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div></div> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-95c9a4e8 data-v-42dd5e05 data-v-42dd5e05><h3 class="title" style="display:none;" data-v-95c9a4e8 data-v-95c9a4e8>Yin的笔记本</h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-95c9a4e8 data-v-95c9a4e8><input type="password" value="" data-v-95c9a4e8> <span data-v-95c9a4e8>Konck! Knock!</span> <button data-v-95c9a4e8>OK</button></label> <div class="footer" style="display:none;" data-v-95c9a4e8 data-v-95c9a4e8><span data-v-95c9a4e8><i class="iconfont reco-theme" data-v-95c9a4e8></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-95c9a4e8>vuePress-theme-reco</a></span> <span data-v-95c9a4e8><i class="iconfont reco-copyright" data-v-95c9a4e8></i> <a data-v-95c9a4e8><span data-v-95c9a4e8>Howard Yin</span>
            
          <span data-v-95c9a4e8>2021 - </span>
          2025
        </a></span></div></div> <div class="hide" data-v-42dd5e05><header class="navbar" data-v-42dd5e05><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.png" alt="Yin的笔记本" class="logo"> <span class="site-name">Yin的笔记本</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      Category
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/CNCF/" class="nav-link"><i class="iconfont undefined"></i>
  CNCF
</a></li><li class="dropdown-item"><!----> <a href="/categories/Docker/" class="nav-link"><i class="iconfont undefined"></i>
  Docker
</a></li><li class="dropdown-item"><!----> <a href="/categories/namespaces/" class="nav-link"><i class="iconfont undefined"></i>
  namespaces
</a></li><li class="dropdown-item"><!----> <a href="/categories/Kubernetes/" class="nav-link"><i class="iconfont undefined"></i>
  Kubernetes
</a></li><li class="dropdown-item"><!----> <a href="/categories/Kubernetes对象/" class="nav-link"><i class="iconfont undefined"></i>
  Kubernetes对象
</a></li><li class="dropdown-item"><!----> <a href="/categories/Linux/" class="nav-link"><i class="iconfont undefined"></i>
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/categories/MyIdeas/" class="nav-link"><i class="iconfont undefined"></i>
  MyIdeas
</a></li><li class="dropdown-item"><!----> <a href="/categories/Revolution/" class="nav-link"><i class="iconfont undefined"></i>
  Revolution
</a></li><li class="dropdown-item"><!----> <a href="/categories/WebRTC/" class="nav-link"><i class="iconfont undefined"></i>
  WebRTC
</a></li><li class="dropdown-item"><!----> <a href="/categories/云计算/" class="nav-link"><i class="iconfont undefined"></i>
  云计算
</a></li><li class="dropdown-item"><!----> <a href="/categories/人工智能/" class="nav-link"><i class="iconfont undefined"></i>
  人工智能
</a></li><li class="dropdown-item"><!----> <a href="/categories/分布式/" class="nav-link"><i class="iconfont undefined"></i>
  分布式
</a></li><li class="dropdown-item"><!----> <a href="/categories/图像处理/" class="nav-link"><i class="iconfont undefined"></i>
  图像处理
</a></li><li class="dropdown-item"><!----> <a href="/categories/图形学/" class="nav-link"><i class="iconfont undefined"></i>
  图形学
</a></li><li class="dropdown-item"><!----> <a href="/categories/微服务/" class="nav-link"><i class="iconfont undefined"></i>
  微服务
</a></li><li class="dropdown-item"><!----> <a href="/categories/数学/" class="nav-link"><i class="iconfont undefined"></i>
  数学
</a></li><li class="dropdown-item"><!----> <a href="/categories/OJ笔记/" class="nav-link"><i class="iconfont undefined"></i>
  OJ笔记
</a></li><li class="dropdown-item"><!----> <a href="/categories/博弈论/" class="nav-link"><i class="iconfont undefined"></i>
  博弈论
</a></li><li class="dropdown-item"><!----> <a href="/categories/形式语言与自动机/" class="nav-link"><i class="iconfont undefined"></i>
  形式语言与自动机
</a></li><li class="dropdown-item"><!----> <a href="/categories/数据库/" class="nav-link"><i class="iconfont undefined"></i>
  数据库
</a></li><li class="dropdown-item"><!----> <a href="/categories/服务器运维/" class="nav-link"><i class="iconfont undefined"></i>
  服务器运维
</a></li><li class="dropdown-item"><!----> <a href="/categories/编程语言/" class="nav-link"><i class="iconfont undefined"></i>
  编程语言
</a></li><li class="dropdown-item"><!----> <a href="/categories/C/" class="nav-link"><i class="iconfont undefined"></i>
  C
</a></li><li class="dropdown-item"><!----> <a href="/categories/Git/" class="nav-link"><i class="iconfont undefined"></i>
  Git
</a></li><li class="dropdown-item"><!----> <a href="/categories/Go/" class="nav-link"><i class="iconfont undefined"></i>
  Go
</a></li><li class="dropdown-item"><!----> <a href="/categories/Java/" class="nav-link"><i class="iconfont undefined"></i>
  Java
</a></li><li class="dropdown-item"><!----> <a href="/categories/JavaScript/" class="nav-link"><i class="iconfont undefined"></i>
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/categories/Python/" class="nav-link"><i class="iconfont undefined"></i>
  Python
</a></li><li class="dropdown-item"><!----> <a href="/categories/Nvidia/" class="nav-link"><i class="iconfont undefined"></i>
  Nvidia
</a></li><li class="dropdown-item"><!----> <a href="/categories/Shell/" class="nav-link"><i class="iconfont undefined"></i>
  Shell
</a></li><li class="dropdown-item"><!----> <a href="/categories/Tex/" class="nav-link"><i class="iconfont undefined"></i>
  Tex
</a></li><li class="dropdown-item"><!----> <a href="/categories/Rust/" class="nav-link"><i class="iconfont undefined"></i>
  Rust
</a></li><li class="dropdown-item"><!----> <a href="/categories/Vue/" class="nav-link"><i class="iconfont undefined"></i>
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/categories/视频编解码/" class="nav-link"><i class="iconfont undefined"></i>
  视频编解码
</a></li><li class="dropdown-item"><!----> <a href="/categories/计算机网络/" class="nav-link"><i class="iconfont undefined"></i>
  计算机网络
</a></li><li class="dropdown-item"><!----> <a href="/categories/SDN/" class="nav-link"><i class="iconfont undefined"></i>
  SDN
</a></li><li class="dropdown-item"><!----> <a href="/categories/论文笔记/" class="nav-link"><i class="iconfont undefined"></i>
  论文笔记
</a></li><li class="dropdown-item"><!----> <a href="/categories/讨论/" class="nav-link"><i class="iconfont undefined"></i>
  讨论
</a></li><li class="dropdown-item"><!----> <a href="/categories/边缘计算/" class="nav-link"><i class="iconfont undefined"></i>
  边缘计算
</a></li><li class="dropdown-item"><!----> <a href="/categories/量子信息技术/" class="nav-link"><i class="iconfont undefined"></i>
  量子信息技术
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><a href="http://profile.yindaheng98.top" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-account"></i>
  About
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/yindaheng98/Notebook/tree/master/学习笔记" target="_blank" rel="noopener noreferrer" class="repo-link"><i class="iconfont reco-查看源码"></i>
    查看源码
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask" data-v-42dd5e05></div> <aside class="sidebar" data-v-42dd5e05><div class="personal-info-wrapper" data-v-0ac41e2e><img src="/avatar.svg" alt="author-avatar" class="personal-img" data-v-0ac41e2e> <h3 class="name" data-v-0ac41e2e>
    Howard Yin
  </h3> <div class="num" data-v-0ac41e2e><div data-v-0ac41e2e><h3 data-v-0ac41e2e>304</h3> <h6 data-v-0ac41e2e>Article</h6></div> <div data-v-0ac41e2e><h3 data-v-0ac41e2e>153</h3> <h6 data-v-0ac41e2e>Tag</h6></div></div> <hr data-v-0ac41e2e></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      Category
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/CNCF/" class="nav-link"><i class="iconfont undefined"></i>
  CNCF
</a></li><li class="dropdown-item"><!----> <a href="/categories/Docker/" class="nav-link"><i class="iconfont undefined"></i>
  Docker
</a></li><li class="dropdown-item"><!----> <a href="/categories/namespaces/" class="nav-link"><i class="iconfont undefined"></i>
  namespaces
</a></li><li class="dropdown-item"><!----> <a href="/categories/Kubernetes/" class="nav-link"><i class="iconfont undefined"></i>
  Kubernetes
</a></li><li class="dropdown-item"><!----> <a href="/categories/Kubernetes对象/" class="nav-link"><i class="iconfont undefined"></i>
  Kubernetes对象
</a></li><li class="dropdown-item"><!----> <a href="/categories/Linux/" class="nav-link"><i class="iconfont undefined"></i>
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/categories/MyIdeas/" class="nav-link"><i class="iconfont undefined"></i>
  MyIdeas
</a></li><li class="dropdown-item"><!----> <a href="/categories/Revolution/" class="nav-link"><i class="iconfont undefined"></i>
  Revolution
</a></li><li class="dropdown-item"><!----> <a href="/categories/WebRTC/" class="nav-link"><i class="iconfont undefined"></i>
  WebRTC
</a></li><li class="dropdown-item"><!----> <a href="/categories/云计算/" class="nav-link"><i class="iconfont undefined"></i>
  云计算
</a></li><li class="dropdown-item"><!----> <a href="/categories/人工智能/" class="nav-link"><i class="iconfont undefined"></i>
  人工智能
</a></li><li class="dropdown-item"><!----> <a href="/categories/分布式/" class="nav-link"><i class="iconfont undefined"></i>
  分布式
</a></li><li class="dropdown-item"><!----> <a href="/categories/图像处理/" class="nav-link"><i class="iconfont undefined"></i>
  图像处理
</a></li><li class="dropdown-item"><!----> <a href="/categories/图形学/" class="nav-link"><i class="iconfont undefined"></i>
  图形学
</a></li><li class="dropdown-item"><!----> <a href="/categories/微服务/" class="nav-link"><i class="iconfont undefined"></i>
  微服务
</a></li><li class="dropdown-item"><!----> <a href="/categories/数学/" class="nav-link"><i class="iconfont undefined"></i>
  数学
</a></li><li class="dropdown-item"><!----> <a href="/categories/OJ笔记/" class="nav-link"><i class="iconfont undefined"></i>
  OJ笔记
</a></li><li class="dropdown-item"><!----> <a href="/categories/博弈论/" class="nav-link"><i class="iconfont undefined"></i>
  博弈论
</a></li><li class="dropdown-item"><!----> <a href="/categories/形式语言与自动机/" class="nav-link"><i class="iconfont undefined"></i>
  形式语言与自动机
</a></li><li class="dropdown-item"><!----> <a href="/categories/数据库/" class="nav-link"><i class="iconfont undefined"></i>
  数据库
</a></li><li class="dropdown-item"><!----> <a href="/categories/服务器运维/" class="nav-link"><i class="iconfont undefined"></i>
  服务器运维
</a></li><li class="dropdown-item"><!----> <a href="/categories/编程语言/" class="nav-link"><i class="iconfont undefined"></i>
  编程语言
</a></li><li class="dropdown-item"><!----> <a href="/categories/C/" class="nav-link"><i class="iconfont undefined"></i>
  C
</a></li><li class="dropdown-item"><!----> <a href="/categories/Git/" class="nav-link"><i class="iconfont undefined"></i>
  Git
</a></li><li class="dropdown-item"><!----> <a href="/categories/Go/" class="nav-link"><i class="iconfont undefined"></i>
  Go
</a></li><li class="dropdown-item"><!----> <a href="/categories/Java/" class="nav-link"><i class="iconfont undefined"></i>
  Java
</a></li><li class="dropdown-item"><!----> <a href="/categories/JavaScript/" class="nav-link"><i class="iconfont undefined"></i>
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/categories/Python/" class="nav-link"><i class="iconfont undefined"></i>
  Python
</a></li><li class="dropdown-item"><!----> <a href="/categories/Nvidia/" class="nav-link"><i class="iconfont undefined"></i>
  Nvidia
</a></li><li class="dropdown-item"><!----> <a href="/categories/Shell/" class="nav-link"><i class="iconfont undefined"></i>
  Shell
</a></li><li class="dropdown-item"><!----> <a href="/categories/Tex/" class="nav-link"><i class="iconfont undefined"></i>
  Tex
</a></li><li class="dropdown-item"><!----> <a href="/categories/Rust/" class="nav-link"><i class="iconfont undefined"></i>
  Rust
</a></li><li class="dropdown-item"><!----> <a href="/categories/Vue/" class="nav-link"><i class="iconfont undefined"></i>
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/categories/视频编解码/" class="nav-link"><i class="iconfont undefined"></i>
  视频编解码
</a></li><li class="dropdown-item"><!----> <a href="/categories/计算机网络/" class="nav-link"><i class="iconfont undefined"></i>
  计算机网络
</a></li><li class="dropdown-item"><!----> <a href="/categories/SDN/" class="nav-link"><i class="iconfont undefined"></i>
  SDN
</a></li><li class="dropdown-item"><!----> <a href="/categories/论文笔记/" class="nav-link"><i class="iconfont undefined"></i>
  论文笔记
</a></li><li class="dropdown-item"><!----> <a href="/categories/讨论/" class="nav-link"><i class="iconfont undefined"></i>
  讨论
</a></li><li class="dropdown-item"><!----> <a href="/categories/边缘计算/" class="nav-link"><i class="iconfont undefined"></i>
  边缘计算
</a></li><li class="dropdown-item"><!----> <a href="/categories/量子信息技术/" class="nav-link"><i class="iconfont undefined"></i>
  量子信息技术
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><a href="http://profile.yindaheng98.top" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-account"></i>
  About
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/yindaheng98/Notebook/tree/master/学习笔记" target="_blank" rel="noopener noreferrer" class="repo-link"><i class="iconfont reco-查看源码"></i>
    查看源码
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>【摘录】相机位姿估计相关代码解读</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/%E5%9B%BE%E5%BD%A2%E5%AD%A6/%E7%9B%B8%E6%9C%BA%E4%BB%A3%E7%A0%81.html#colmap" class="sidebar-link">Colmap</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/%E5%9B%BE%E5%BD%A2%E5%AD%A6/%E7%9B%B8%E6%9C%BA%E4%BB%A3%E7%A0%81.html#第一步：特征点检测与特征提取" class="sidebar-link">第一步：特征点检测与特征提取</a></li><li class="sidebar-sub-header"><a href="/%E5%9B%BE%E5%BD%A2%E5%AD%A6/%E7%9B%B8%E6%9C%BA%E4%BB%A3%E7%A0%81.html#第二步：特征点匹配" class="sidebar-link">第二步：特征点匹配</a></li><li class="sidebar-sub-header"><a href="/%E5%9B%BE%E5%BD%A2%E5%AD%A6/%E7%9B%B8%E6%9C%BA%E4%BB%A3%E7%A0%81.html#第三步：计算相机内参外参和稀疏点云" class="sidebar-link">第三步：计算相机内参外参和稀疏点云</a></li><li class="sidebar-sub-header"><a href="/%E5%9B%BE%E5%BD%A2%E5%AD%A6/%E7%9B%B8%E6%9C%BA%E4%BB%A3%E7%A0%81.html#第三步-2：已知相机位姿计算稀疏点云" class="sidebar-link">第三步.2：已知相机位姿计算稀疏点云</a></li><li class="sidebar-sub-header"><a href="/%E5%9B%BE%E5%BD%A2%E5%AD%A6/%E7%9B%B8%E6%9C%BA%E4%BB%A3%E7%A0%81.html#第四步-可选-：修复图像扭曲" class="sidebar-link">第四步(可选)：修复图像扭曲</a></li></ul></li><li><a href="/%E5%9B%BE%E5%BD%A2%E5%AD%A6/%E7%9B%B8%E6%9C%BA%E4%BB%A3%E7%A0%81.html#llff真实数据格式" class="sidebar-link">LLFF真实数据格式</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/%E5%9B%BE%E5%BD%A2%E5%AD%A6/%E7%9B%B8%E6%9C%BA%E4%BB%A3%E7%A0%81.html#colmap到llff数据格式" class="sidebar-link">COLMAP到LLFF数据格式</a></li><li class="sidebar-sub-header"><a href="/%E5%9B%BE%E5%BD%A2%E5%AD%A6/%E7%9B%B8%E6%9C%BA%E4%BB%A3%E7%A0%81.html#poses-bounds-npy里有什么" class="sidebar-link">poses_bounds.npy里有什么</a></li></ul></li><li><a href="/%E5%9B%BE%E5%BD%A2%E5%AD%A6/%E7%9B%B8%E6%9C%BA%E4%BB%A3%E7%A0%81.html#load-llff-py代码解读" class="sidebar-link">load_llff.py代码解读</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/%E5%9B%BE%E5%BD%A2%E5%AD%A6/%E7%9B%B8%E6%9C%BA%E4%BB%A3%E7%A0%81.html#drb到rub的变换" class="sidebar-link">DRB到RUB的变换</a></li><li class="sidebar-sub-header"><a href="/%E5%9B%BE%E5%BD%A2%E5%AD%A6/%E7%9B%B8%E6%9C%BA%E4%BB%A3%E7%A0%81.html#缩放图像需要修改什么相机参数？" class="sidebar-link">缩放图像需要修改什么相机参数？</a></li><li class="sidebar-sub-header"><a href="/%E5%9B%BE%E5%BD%A2%E5%AD%A6/%E7%9B%B8%E6%9C%BA%E4%BB%A3%E7%A0%81.html#viewmatrix" class="sidebar-link">viewmatrix()</a></li><li class="sidebar-sub-header"><a href="/%E5%9B%BE%E5%BD%A2%E5%AD%A6/%E7%9B%B8%E6%9C%BA%E4%BB%A3%E7%A0%81.html#poses-avg" class="sidebar-link">poses_avg()</a></li><li class="sidebar-sub-header"><a href="/%E5%9B%BE%E5%BD%A2%E5%AD%A6/%E7%9B%B8%E6%9C%BA%E4%BB%A3%E7%A0%81.html#recenter-poses" class="sidebar-link">recenter_poses()</a></li><li class="sidebar-sub-header"><a href="/%E5%9B%BE%E5%BD%A2%E5%AD%A6/%E7%9B%B8%E6%9C%BA%E4%BB%A3%E7%A0%81.html#render-path-spiral" class="sidebar-link">renderpathspiral()</a></li><li class="sidebar-sub-header"><a href="/%E5%9B%BE%E5%BD%A2%E5%AD%A6/%E7%9B%B8%E6%9C%BA%E4%BB%A3%E7%A0%81.html#spherify-poses" class="sidebar-link">spherify_poses()</a></li></ul></li></ul></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-95c9a4e8 data-v-42dd5e05><h3 class="title" style="display:none;" data-v-95c9a4e8 data-v-95c9a4e8>【摘录】相机位姿估计相关代码解读</h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-95c9a4e8 data-v-95c9a4e8><input type="password" value="" data-v-95c9a4e8> <span data-v-95c9a4e8>Konck! Knock!</span> <button data-v-95c9a4e8>OK</button></label> <div class="footer" style="display:none;" data-v-95c9a4e8 data-v-95c9a4e8><span data-v-95c9a4e8><i class="iconfont reco-theme" data-v-95c9a4e8></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-95c9a4e8>vuePress-theme-reco</a></span> <span data-v-95c9a4e8><i class="iconfont reco-copyright" data-v-95c9a4e8></i> <a data-v-95c9a4e8><span data-v-95c9a4e8>Howard Yin</span>
            
          <span data-v-95c9a4e8>2021 - </span>
          2025
        </a></span></div></div> <div data-v-42dd5e05><main class="page"><div class="page-title" style="display:none;"><h1>【摘录】相机位姿估计相关代码解读</h1> <hr> <div data-v-3d9cec6e><i class="iconfont reco-account" data-v-3d9cec6e><span data-v-3d9cec6e>Howard Yin</span></i> <i class="iconfont reco-date" data-v-3d9cec6e><span data-v-3d9cec6e>2024-08-25 01:18:03</span></i> <!----> <i class="iconfont reco-tag tags" data-v-3d9cec6e><span class="tag-item" data-v-3d9cec6e>图形学</span></i></div></div> <div class="theme-reco-content content__default" style="display:none;"><p><a href="https://zhuanlan.zhihu.com/p/593204605/" target="_blank" rel="noopener noreferrer">原文<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="/图形学/相机参数与坐标系变换.html">前置知识</a></p> <h2 id="colmap"><a href="#colmap" class="header-anchor">#</a> Colmap</h2> <p>下面是COLMAP官网教程给的三个命令行操作步骤：</p> <h3 id="第一步：特征点检测与特征提取"><a href="#第一步：特征点检测与特征提取" class="header-anchor">#</a> 第一步：特征点检测与特征提取</h3> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">mkdir</span> ./distorted
colmap feature_extractor <span class="token punctuation">\</span>
 --database_path ./distorted/database.db <span class="token punctuation">\</span>
 --image_path ./input
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>这一步会在<code>database.db</code>中的<code>keypoints</code>和<code>descriptors</code>表中分别写入每个图像上的关键点位置和特征向量。</p> <p><img src="i/20240821162820.png" alt=""></p> <p><img src="i/20240821162920.png" alt=""></p> <h3 id="第二步：特征点匹配"><a href="#第二步：特征点匹配" class="header-anchor">#</a> 第二步：特征点匹配</h3> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>colmap exhaustive_matcher <span class="token punctuation">\</span>
 --database_path ./distorted/database.db
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>这一步会在<code>database.db</code>中的<code>matches</code>和<code>two_view_geometries</code>表中分别写入匹配到的关键点信息。</p> <p><img src="i/20240821163546.png" alt=""></p> <p><img src="i/20240821163612.png" alt=""></p> <h3 id="第三步：计算相机内参外参和稀疏点云"><a href="#第三步：计算相机内参外参和稀疏点云" class="header-anchor">#</a> 第三步：计算相机内参外参和稀疏点云</h3> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">mkdir</span> ./distorted/sparse
colmap mapper <span class="token punctuation">\</span>
 --database_path ./distorted/database.db <span class="token punctuation">\</span>
 --image_path ./input <span class="token punctuation">\</span>
 --output_path ./distorted/sparse
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>这一步会在<code>distorted/sparse/0</code>中生成：</p> <ul><li><code>cameras.bin</code>: 相机内参</li> <li><code>images.bin</code>: 相机外参和匹配到的特征点位置</li> <li><code>points3D.bin</code>: 稀疏点云（各特征点在三维空间中的位置）</li></ul> <p><img src="i/20240821164201.png" alt=""></p> <p>可用<code>model_converter</code>将<code>.bin</code>转换为<code>.txt</code>方便查看其内容：</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>colmap model_converter <span class="token punctuation">\</span>
 --input_path ./distorted/sparse/0 <span class="token punctuation">\</span>
 --output_path ./distorted/sparse/0 <span class="token punctuation">\</span>
 --output_type TXT
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><code>cameras.txt</code>:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code># Camera list with one line of data per camera:
#   CAMERA_ID, MODEL, WIDTH, HEIGHT, PARAMS[]
# Number of cameras: 18
1 SIMPLE_RADIAL 2704 2028 1463.602151128247 1352 1014 0.0055591746999265682
2 SIMPLE_RADIAL 2704 2028 1459.0935698535297 1352 1014 0.0043112655758058933
......
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><code>images.txt</code>:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code># Image list with two lines of data per image:
#   IMAGE_ID, QW, QX, QY, QZ, TX, TY, TZ, CAMERA_ID, NAME
#   POINTS2D[] as (X, Y, POINT3D_ID)
# Number of images: 18, mean observations per image: 1788.7777777777778
1 0.98886101182065456 0.0044390132483014396 -0.14831889032221729 -0.011649087346175238 -0.42030913678886445 1.1207070471455038 0.17055071781075895 1 cam00.png
2536.1962890625 2.5554940700531006 -1 2563.796142578125 3.3455758094787598 -1 2563.796142578125 3.3455758094787598 -1 ......
2 0.98785045325706367 0.0020990654656298869 0.15458715378189467 -0.015807840130701221 -5.1862595908224201 1.1472383676217863 1.9528211257224539 2 cam01.png
2076.231201171875 2.6291365623474121 -1 2044.87548828125 7.0014801025390625 -1 2256.88916015625 8.5179100036621094 -1 ......
......
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><code>points3D.txt</code>:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code># 3D point list with one line of data per point:
#   POINT3D_ID, X, Y, Z, R, G, B, ERROR, TRACK[] as (IMAGE_ID, POINT2D_IDX)
# Number of points: 6876, mean track length: 4.6826643397324021
944 -2.6695841488219187 3.1376744856540726 13.459112784068168 109 100 113 0.51410901285639965 5 9832 6 11428 1 9899
1 14.849014740997124 -10.071613195692301 12.374907618510433 146 141 138 0.81580193115576016 5 58 6 333 16 316 15 3845
3517 -6.2905061230055503 5.0936986733548917 11.565100043362957 96 90 95 0.87127356787417265 5 10491 4 9373 3 9628 14 9348 13 8953
2 11.384284233822777 -5.0228600507699417 16.028219283545791 113 103 120 0.5440608582630676 5 320 6 667 3 4185 15 292 13 207 11 310
......
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="第三步-2：已知相机位姿计算稀疏点云"><a href="#第三步-2：已知相机位姿计算稀疏点云" class="header-anchor">#</a> 第三步.2：已知相机位姿计算稀疏点云</h3> <h3 id="第四步-可选-：修复图像扭曲"><a href="#第四步-可选-：修复图像扭曲" class="header-anchor">#</a> 第四步(可选)：修复图像扭曲</h3> <p>使用COLMAP得到相机参数后只需要转成NeRF可以读取的格式即可以用于模型训练了。
有些相机镜头（比如各种广角镜头）可能会造成图像扭曲，已知相机外参和稀疏点云的情况下可计算出图像的扭曲情况。
COLMAP可选多种相机模型，分别对应不同的扭曲模式：</p> <blockquote><ul><li><code>SIMPLE_PINHOLE</code>, <code>PINHOLE</code>: Use these camera models, if your images are undistorted a priori. These use one and two focal length parameters, respectively. Note that even in the case of undistorted images, COLMAP could try to improve the intrinsics with a more complex camera model.</li> <li><code>SIMPLE_RADIAL</code>, <code>RADIAL</code>: This should be the camera model of choice, if the intrinsics are unknown and every image has a different camera calibration, e.g., in the case of Internet photos. Both models are simplified versions of the <code>OPENCV</code> model only modeling radial distortion effects with one and two parameters, respectively.</li> <li><code>OPENCV</code>, <code>FULL_OPENCV</code>: Use these camera models, if you know the calibration parameters a priori. You can also try to let COLMAP estimate the parameters, if you share the intrinsics for multiple images. Note that the automatic estimation of parameters will most likely fail, if every image has a separate set of intrinsic parameters.</li> <li><code>SIMPLE_RADIAL_FISHEYE</code>, <code>RADIAL_FISHEYE</code>, <code>OPENCV_FISHEYE</code>, <code>FOV</code>, <code>THIN_PRISM_FISHEYE</code>: Use these camera models for fisheye lenses and note that all other models are not really capable of modeling the distortion effects of fisheye lenses. The <code>FOV</code> model is used by Google Project Tango (make sure to not initialize omega to zero).</li></ul></blockquote> <p>可以进一步使用<code>image_undistorter</code>将图像扭回针孔相机模式，这样可以一定程度上提高NeRF的重建质量：</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>colmap image_undistorter <span class="token punctuation">\</span>
 --image_path ./input <span class="token punctuation">\</span>
 --input_path ./distorted/sparse/0 <span class="token punctuation">\</span>
 --output_path <span class="token builtin class-name">.</span> <span class="token punctuation">\</span>
 --output_type COLMAP
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>这一步会在<code>sparse/0</code>中生成扭回针孔相机模式后的相机内参外参、在<code>images</code>中生成扭回针孔相机模式的图像。</p> <p><img src="i/20240821171047.png" alt=""></p> <p>COLMAP也集成了Multiview Stereo (MVS)算法用于重建场景完整的三维结构，也称为 <a href="/图形学/DenseReconstruct.html">Dense Reconstruction</a>。
<code>image_undistorter</code>生成的<code>stereo</code>文件夹和两个<code>.sh</code>文件即与此有关。</p> <h2 id="llff真实数据格式"><a href="#llff真实数据格式" class="header-anchor">#</a> LLFF真实数据格式</h2> <p>NeRF代码里用load_llff.py这个文件来读取真实的数据，第一次看到LLFF这个词可能不知道是什么意思。其实LLFF <a href="https://github.com/fyusion/llff" target="_blank" rel="noopener noreferrer">GitHub - Fyusion/LLFF: Code release for Local Light Field Fusion at SIGGRAPH 2019<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 是NeRF作者的上一篇做新视角合成的工作。为了和LLFF方法保持一致的数据格式，NeRF使用load_llff.py读取LLFF格式的真实数据，并建议大家使用LLFF提供的的<a href="https://github.com/Fyusion/LLFF/blob/master/imgs2poses.py" target="_blank" rel="noopener noreferrer">imgs2poses.py<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>文件获取所需相机参数。</p> <h3 id="colmap到llff数据格式"><a href="#colmap到llff数据格式" class="header-anchor">#</a> COLMAP到LLFF数据格式</h3> <p>imgs2poses.py这个文件其实很简单，就干了两件事。</p> <ul><li>第一件事是调用colmap软件估计相机的参数，在sparse/0/文件夹下生成一些二进制文件：cameras.bin, images.bin, points3D.bin, project.ini。</li> <li>第二件事是读取上一步得到的二进制文件，保存成一个poses_bounds.npy文件。</li></ul> <p>这里有一个细节需要注意，就是在pose_utils.py文件里load_colmap_data()函数的倒数第二行，有一个操作将colmap得到的c2w旋转矩阵中的第一列和第二列互换，第三列乘以负号：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># LLFF/llff/poses/pose_utils.py</span>
<span class="token keyword">def</span> <span class="token function">load_colmap_data</span><span class="token punctuation">(</span>realdir<span class="token punctuation">)</span><span class="token punctuation">:</span>
 <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> 
 <span class="token comment"># must switch to [-u, r, -t] from [r, -u, t], NOT [r, u, -t]</span>
 poses <span class="token operator">=</span> np<span class="token punctuation">.</span>concatenate<span class="token punctuation">(</span><span class="token punctuation">[</span>poses<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span> poses<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">-</span>poses<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span> poses<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span> poses<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
 <span class="token keyword">return</span> poses<span class="token punctuation">,</span> pts3d<span class="token punctuation">,</span> perm
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>还记得刚刚提到c2w旋转矩阵的三列向量分别代表XYZ轴的朝向，上述操作实际上就是把相机坐标系轴的朝向进行了变换：X和Y轴调换，Z轴取反，如下图所示：</p> <p><img src="zhimg.com/v2-2fd40a1fed515ff8a1e566659083be93_r.jpg" alt="从Colmap的坐标系转到LLFF的坐标系"></p> <h3 id="poses-bounds-npy里有什么"><a href="#poses-bounds-npy里有什么" class="header-anchor">#</a> poses_bounds.npy里有什么</h3> <p>load_llff.py会直接读取poses_bounds.npy文件获得相机参数。poses_bounds.npy是一个Nx17的矩阵，其中N是图像的数量，即每一张图像有17个参数。其中前面15个参数可以重排成3x5的矩阵形式：</p> <p><img src="zhimg.com/v2-7cbd00d9af3e699d86654a7cb06f660a_b.jpg" alt="poses_bounds.npy的前15维参数。左边3x3矩阵是c2w的旋转矩阵，第四列是c2w的平移向量，第五列分别是图像的高H、宽W和相机的焦距f"></p> <p>最后两个参数用于表示场景的范围 <strong>Bounds (bds)</strong> ，是该相机视角下场景点离相机中心最近(near)和最远(far)的距离，所以near/far肯定是大于0的。</p> <ul><li>这两个值是怎么得到的？是在imgs2poses.py中，计算colmap重建的 <strong>3D稀疏点</strong> 在各个相机视角下最近和最远的距离得到的。</li> <li>这两个值有什么用？之前提到体素渲染需要在一条射线上采样3D点，这就需要一个采样区间，而near和far就是定义了采样区间的最近点和最远点。贴近场景边界的near/far可以使采样点分布更加密集，从而有效地提升收敛速度和渲染质量。</li></ul> <p><img src="zhimg.com/v2-150e45eb0986be09b17f9f0cf34f4cb5_r.jpg" alt="poses_bounds.npy里最后两个参数（near/far）的作用示意图"></p> <h2 id="load-llff-py代码解读"><a href="#load-llff-py代码解读" class="header-anchor">#</a> load_llff.py代码解读</h2> <p>接着，我们介绍NeRF代码里load_llff.py代码里的一些细节。对三维视觉不熟悉的读者，早期读代码的时候可能会有不少困惑。</p> <h3 id="drb到rub的变换"><a href="#drb到rub的变换" class="header-anchor">#</a> DRB到RUB的变换</h3> <p>第一个疑问是，为什么读进poses_bounds.npy里的c2w矩阵之后，对c2w的旋转矩阵又做了一些列变换？</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># load_llff.py文件</span>
<span class="token keyword">def</span> <span class="token function">load_llff_data</span><span class="token punctuation">(</span>basedir<span class="token punctuation">,</span> factor<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">,</span> recenter<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> bd_factor<span class="token operator">=</span><span class="token number">.75</span><span class="token punctuation">,</span> spherify<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> path_zflat<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
 
 poses<span class="token punctuation">,</span> bds<span class="token punctuation">,</span> imgs <span class="token operator">=</span> _load_data<span class="token punctuation">(</span>basedir<span class="token punctuation">,</span> factor<span class="token operator">=</span>factor<span class="token punctuation">)</span> <span class="token comment"># factor=8 downsamples original imgs by 8x</span>
 <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Loaded'</span><span class="token punctuation">,</span> basedir<span class="token punctuation">,</span> bds<span class="token punctuation">.</span><span class="token builtin">min</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> bds<span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
 
 <span class="token comment"># Correct rotation matrix ordering and move variable dim to axis 0</span>
 poses <span class="token operator">=</span> np<span class="token punctuation">.</span>concatenate<span class="token punctuation">(</span><span class="token punctuation">[</span>poses<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">-</span>poses<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span> poses<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
 <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>上面的代码段的最后一行实际上是把旋转矩阵的第一列（X轴）和第二列（Y轴）互换，并且对第二列（Y轴）做了一个反向。这样做的目的是将LLFF的相机坐标系变成OpenGL/NeRF的相机坐标系，如下图所示。</p> <p><img src="zhimg.com/v2-5e780f468e73b8e2e21913b3722986d8_r.jpg" alt="poses = np.concatenate([poses[:, 1:2, :], -poses[:, 0:1, :], poses[:, 2:, :]], 1)"></p> <h3 id="缩放图像需要修改什么相机参数？"><a href="#缩放图像需要修改什么相机参数？" class="header-anchor">#</a> 缩放图像需要修改什么相机参数？</h3> <p>在_load_data()函数里，有一个用于图像缩放的factor比例参数，将HxW的图像缩放成(H/factor)x(W/factor)。这里面有一个问题是如果缩放了图像尺寸，相机的参数需要相应的做什么变化？</p> <ul><li>做法是： <strong>外参（位置和朝向）不变，相机的焦距f，cx, 和cy等比例缩放</strong> 。下图的示意图展示了当相机位置不变，相机视野(Field of view, FOV)不变的情况下，图像的高和焦距长短的关系。</li></ul> <p><img src="zhimg.com/v2-cbf207d49865d7583a6b8da626026711_r.jpg" alt="图像平面1与图像平面2拍摄的图像内容是一样的，只是分辨率不同"></p> <h3 id="viewmatrix"><a href="#viewmatrix" class="header-anchor">#</a> viewmatrix()</h3> <p>view_matrix是一个构造相机矩阵的的函数，输入是相机的 <strong>Z轴朝向</strong> 、 <strong>up轴的朝向</strong> (即相机平面朝上的方向Y)、以及 <strong>相机中心</strong> 。输出下图所示的camera-to-world (c2w)矩阵。因为Z轴朝向，Y轴朝向，和相机中心都已经给定，所以只需求X轴的方向即可。又由于X轴同时和Z轴和Y轴垂直，我们可以用Y轴与Z轴的叉乘得到X轴方向。</p> <p><img src="zhimg.com/v2-5a6ebf24243b536f2065cdbd253bb7e8_b.jpg" alt="camera-to-world matrix"></p> <p>下面是load_llff.py里关于view_matrix()的定义，看起来复杂一些。其实就是比刚刚的描述比多了一步：在用Y轴与Z轴叉乘得到X轴后，再次用Z轴与X轴叉乘得到新的Y轴。为什么这么做呢？这是因为传入的up(Y)轴是通过一些计算得到的，不一定和Z轴垂直，所以多这么一步。</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># load_llff.py</span>
<span class="token keyword">def</span> <span class="token function">viewmatrix</span><span class="token punctuation">(</span>z<span class="token punctuation">,</span> up<span class="token punctuation">,</span> pos<span class="token punctuation">)</span><span class="token punctuation">:</span>
 vec2 <span class="token operator">=</span> normalize<span class="token punctuation">(</span>z<span class="token punctuation">)</span>
 vec1_avg <span class="token operator">=</span> up
 vec0 <span class="token operator">=</span> normalize<span class="token punctuation">(</span>np<span class="token punctuation">.</span>cross<span class="token punctuation">(</span>vec1_avg<span class="token punctuation">,</span> vec2<span class="token punctuation">)</span><span class="token punctuation">)</span>
 vec1 <span class="token operator">=</span> normalize<span class="token punctuation">(</span>np<span class="token punctuation">.</span>cross<span class="token punctuation">(</span>vec2<span class="token punctuation">,</span> vec0<span class="token punctuation">)</span><span class="token punctuation">)</span>
 m <span class="token operator">=</span> np<span class="token punctuation">.</span>stack<span class="token punctuation">(</span><span class="token punctuation">[</span>vec0<span class="token punctuation">,</span> vec1<span class="token punctuation">,</span> vec2<span class="token punctuation">,</span> pos<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
 <span class="token keyword">return</span> m
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="poses-avg"><a href="#poses-avg" class="header-anchor">#</a> poses_avg()</h3> <p>这个函数其实很简单，顾名思义就是多个相机的平均位姿（包括位置和朝向）。输入是多个相机的位姿。</p> <ul><li>第一步对多个相机的中心进行求均值得到 <strong>center</strong> 。</li> <li>第二步对所有相机的Z轴求平均得到 <strong>vec2</strong> 向量（方向向量相加其实等效于平均方向向量）。</li> <li>第三步对所有的相机的Y轴求平均得到 <strong>up</strong> 向量。</li> <li>最后将vec2, up, 和center输入到刚刚介绍的viewmatrix()函数就可以得到平均的相机位姿了。</li></ul> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">poses_avg</span><span class="token punctuation">(</span>poses<span class="token punctuation">)</span><span class="token punctuation">:</span>
 hwf <span class="token operator">=</span> poses<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
 center <span class="token operator">=</span> poses<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
 vec2 <span class="token operator">=</span> normalize<span class="token punctuation">(</span>poses<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
 up <span class="token operator">=</span> poses<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
 c2w <span class="token operator">=</span> np<span class="token punctuation">.</span>concatenate<span class="token punctuation">(</span><span class="token punctuation">[</span>viewmatrix<span class="token punctuation">(</span>vec2<span class="token punctuation">,</span> up<span class="token punctuation">,</span> center<span class="token punctuation">)</span><span class="token punctuation">,</span> hwf<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
 
 <span class="token keyword">return</span> c2w
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>下图展示了一个poses_avg()函数的例子。左边是多个输入相机的位姿，右边是返回的平均相机姿态。可以看出平均相机位姿的位置和朝向是之前所有相机的均值。</p> <p><img src="zhimg.com/v2-c2b471eabfef0ecd18f7c24007738a08_r.jpg" alt="中间大的坐标系是世界坐标系，每一个小的坐标系对应一个相机的局部坐标系。红绿蓝(RGB)轴分别代表XYZ轴"></p> <h3 id="recenter-poses"><a href="#recenter-poses" class="header-anchor">#</a> recenter_poses()</h3> <p>recenter_poses()函数的名字听起来是中心化相机位姿（同样包括位置和朝向）的意思。输入N个相机位姿，会返回N个相机位姿。</p> <p>具体的操作了解起来可能有点跳跃。第一步先用刚刚介绍的poses_avg(poses)得到多个输入相机的平均位姿c2w，接着用这个平均位姿c2w的逆左乘到输入的相机位姿上就完成了归一化。</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">recenter_poses</span><span class="token punctuation">(</span>poses<span class="token punctuation">)</span><span class="token punctuation">:</span>
 poses_ <span class="token operator">=</span> poses<span class="token operator">+</span><span class="token number">0</span>
 bottom <span class="token operator">=</span> np<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
 c2w <span class="token operator">=</span> poses_avg<span class="token punctuation">(</span>poses<span class="token punctuation">)</span>
 c2w <span class="token operator">=</span> np<span class="token punctuation">.</span>concatenate<span class="token punctuation">(</span><span class="token punctuation">[</span>c2w<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span> bottom<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span>
 bottom <span class="token operator">=</span> np<span class="token punctuation">.</span>tile<span class="token punctuation">(</span>np<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span>bottom<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>poses<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
 poses <span class="token operator">=</span> np<span class="token punctuation">.</span>concatenate<span class="token punctuation">(</span><span class="token punctuation">[</span>poses<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span> bottom<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span>
 poses <span class="token operator">=</span> np<span class="token punctuation">.</span>linalg<span class="token punctuation">.</span>inv<span class="token punctuation">(</span>c2w<span class="token punctuation">)</span> @ poses
 poses_<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> poses<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">]</span>
 poses <span class="token operator">=</span> poses_
 <span class="token keyword">return</span> poses
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>首先我们要知道利用同一个旋转平移变换矩阵左乘所有的相机位姿是对所有的相机位姿做一个 <strong>全局的旋转平移变换</strong> ，那下一个问题就是这些相机会被变到什么样的一个位置？我们可以用平均相机位姿作为支点理解，如果把平均位姿的逆c2w^-1左乘平均相机位姿c2w，返回的相机位姿中旋转矩阵为单位矩阵，平移量为零向量。也就是变换后的平均相机位姿的位置处在世界坐标系的原点，XYZ轴朝向和世界坐标系的向一致。</p> <p>下图我们用一个例子帮助理解。左边和右边分别是输入和输出的相机位姿示意图。我们可以看到变换后的多个相机的平均位姿处在世界坐标系的原点，并且相机坐标系的XYZ轴与世界坐标系保持一致了。</p> <p><img src="zhimg.com/v2-5d890d500cacd9c1b3ddfc95327e5262_r.jpg" alt="中间大的坐标系是世界坐标系，每一个小的坐标系对应一个相机的局部坐标系。红绿蓝(RGB)轴分别代表XYZ轴"></p> <h3 id="render-path-spiral"><a href="#render-path-spiral" class="header-anchor">#</a> render_path_spiral()</h3> <p>这个函数写的有点复杂，它和模型训练没有关系，主要是用来生成一个相机轨迹用于新视角的合成，如下面视频所示：
<a href="https://www.zhihu.com/video/1589569584843169793" target="_blank" rel="noopener noreferrer">https://www.zhihu.com/video/1589569584843169793<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
下面只放了render_path_spiral()函数的定义，NeRF代码里还有一段是在准备输入参数，由于相关代码比较长就不贴出来。</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">render_path_spiral</span><span class="token punctuation">(</span>c2w<span class="token punctuation">,</span> up<span class="token punctuation">,</span> rads<span class="token punctuation">,</span> focal<span class="token punctuation">,</span> zdelta<span class="token punctuation">,</span> zrate<span class="token punctuation">,</span> rots<span class="token punctuation">,</span> N<span class="token punctuation">)</span><span class="token punctuation">:</span>
 render_poses <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
 rads <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span>rads<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
 hwf <span class="token operator">=</span> c2w<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">]</span>
 
 <span class="token keyword">for</span> theta <span class="token keyword">in</span> np<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">.</span> <span class="token operator">*</span> np<span class="token punctuation">.</span>pi <span class="token operator">*</span> rots<span class="token punctuation">,</span> N<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
 c <span class="token operator">=</span> np<span class="token punctuation">.</span>dot<span class="token punctuation">(</span>c2w<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span>np<span class="token punctuation">.</span>cos<span class="token punctuation">(</span>theta<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">-</span>np<span class="token punctuation">.</span>sin<span class="token punctuation">(</span>theta<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">-</span>np<span class="token punctuation">.</span>sin<span class="token punctuation">(</span>theta<span class="token operator">*</span>zrate<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">*</span> rads<span class="token punctuation">)</span> 
 z <span class="token operator">=</span> normalize<span class="token punctuation">(</span>c <span class="token operator">-</span> np<span class="token punctuation">.</span>dot<span class="token punctuation">(</span>c2w<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token operator">-</span>focal<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
 render_poses<span class="token punctuation">.</span>append<span class="token punctuation">(</span>np<span class="token punctuation">.</span>concatenate<span class="token punctuation">(</span><span class="token punctuation">[</span>viewmatrix<span class="token punctuation">(</span>z<span class="token punctuation">,</span> up<span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">,</span> hwf<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
 <span class="token keyword">return</span> render_poses
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>需要知道这个函数它是想生成一段螺旋式的相机轨迹，相机绕着一个轴旋转，其中相机始终注视着一个焦点，相机的up轴保持不变。简单说一下上面的代码：</p> <p>首先是一个for循环，每一迭代生成一个新的相机位置。c是当前迭代的相机在世界坐标系的位置，np.dot(c2w[:3,:4], np.array([0,0,-focal, 1.])是焦点在世界坐标系的位置，z是相机z轴在世界坐标系的朝向。接着使用介绍的viewmatrix(z, up, c)构造当前相机的矩阵。</p> <p>下面这个图可视化了 render_path_spiral()生成的轨迹。</p> <p><img src="zhimg.com/v2-3a5bff2979134d7abb64f2c13d41c2de_r.jpg" alt="中间大的坐标系是世界坐标系，每一个小的坐标系对应一个相机的局部坐标系。红绿蓝(RGB)轴分别代表XYZ轴"></p> <h3 id="spherify-poses"><a href="#spherify-poses" class="header-anchor">#</a> spherify_poses()</h3> <p>刚刚介绍的render_path_spiral()假设所有相机都朝向某一个方向，也就是所谓的faceforward场景。对于相机围绕着一个物体拍摄的360度场景，NeRF代码提供了一个spherify_poses()的函数用于&quot;球面化&quot;相机分布并返回一个环绕的相机轨迹用于新视角合成。这里插一句，在训练360度场景的时候，需要配合&quot;--no_ndc --spherify --lindisp&quot;三个参数以得到好的结果，具体原理这里不展开介绍。</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code> <span class="token keyword">if</span> spherify<span class="token punctuation">:</span>
 poses<span class="token punctuation">,</span> render_poses<span class="token punctuation">,</span> bds <span class="token operator">=</span> spherify_poses<span class="token punctuation">(</span>poses<span class="token punctuation">,</span> bds<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>这个函数也比较复杂，前半部分是在将输入的相机参数进行归一化，后半部分是生成一段相机轨迹用于合成新视角。对输入相机参数进行归一化时，思路是：</p> <ul><li>用 pt_mindist = min_line_dist(rays_o, rays_d)找到离所有相机中心射线距离之和最短的点（可以先简单理解成场景的中心位置）</li></ul> <div class="language-python line-numbers-mode"><pre class="language-python"><code> rays_d <span class="token operator">=</span> poses<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">]</span>
 rays_o <span class="token operator">=</span> poses<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">]</span>
 <span class="token keyword">def</span> <span class="token function">min_line_dist</span><span class="token punctuation">(</span>rays_o<span class="token punctuation">,</span> rays_d<span class="token punctuation">)</span><span class="token punctuation">:</span>
 A_i <span class="token operator">=</span> np<span class="token punctuation">.</span>eye<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">-</span> rays_d <span class="token operator">*</span> np<span class="token punctuation">.</span>transpose<span class="token punctuation">(</span>rays_d<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
 b_i <span class="token operator">=</span> <span class="token operator">-</span>A_i @ rays_o
 pt_mindist <span class="token operator">=</span> np<span class="token punctuation">.</span>squeeze<span class="token punctuation">(</span><span class="token operator">-</span>np<span class="token punctuation">.</span>linalg<span class="token punctuation">.</span>inv<span class="token punctuation">(</span><span class="token punctuation">(</span>np<span class="token punctuation">.</span>transpose<span class="token punctuation">(</span>A_i<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> @ A_i<span class="token punctuation">)</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> @ <span class="token punctuation">(</span>b_i<span class="token punctuation">)</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
 <span class="token keyword">return</span> pt_mindist
 pt_mindist <span class="token operator">=</span> min_line_dist<span class="token punctuation">(</span>rays_o<span class="token punctuation">,</span> rays_d<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><ul><li>将得到的场景中心位置移到世界坐标系的原点，同时将所有相机z轴的平均方向转到和世界坐标系的z轴相同</li></ul> <div class="language-python line-numbers-mode"><pre class="language-python"><code> center <span class="token operator">=</span> pt_mindist
 up <span class="token operator">=</span> <span class="token punctuation">(</span>poses<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">-</span> center<span class="token punctuation">)</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
 vec0 <span class="token operator">=</span> normalize<span class="token punctuation">(</span>up<span class="token punctuation">)</span>
 vec1 <span class="token operator">=</span> normalize<span class="token punctuation">(</span>np<span class="token punctuation">.</span>cross<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">.1</span><span class="token punctuation">,</span><span class="token number">.2</span><span class="token punctuation">,</span><span class="token number">.3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> vec0<span class="token punctuation">)</span><span class="token punctuation">)</span>
 vec2 <span class="token operator">=</span> normalize<span class="token punctuation">(</span>np<span class="token punctuation">.</span>cross<span class="token punctuation">(</span>vec0<span class="token punctuation">,</span> vec1<span class="token punctuation">)</span><span class="token punctuation">)</span>
 pos <span class="token operator">=</span> center
 c2w <span class="token operator">=</span> np<span class="token punctuation">.</span>stack<span class="token punctuation">(</span><span class="token punctuation">[</span>vec1<span class="token punctuation">,</span> vec2<span class="token punctuation">,</span> vec0<span class="token punctuation">,</span> pos<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
 poses_reset <span class="token operator">=</span> np<span class="token punctuation">.</span>linalg<span class="token punctuation">.</span>inv<span class="token punctuation">(</span>p34_to_44<span class="token punctuation">(</span>c2w<span class="token punctuation">[</span><span class="token boolean">None</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> @ p34_to_44<span class="token punctuation">(</span>poses<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><ul><li>最后将相机的位置缩放到单位圆内</li></ul> <div class="language-python line-numbers-mode"><pre class="language-python"><code> rad <span class="token operator">=</span> np<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span>np<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>np<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span>np<span class="token punctuation">.</span>square<span class="token punctuation">(</span>poses_reset<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
 sc <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">.</span><span class="token operator">/</span>rad
 poses_reset<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">*=</span> sc
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>下面这个图可视化了spherify_poses()返回的结果。</p> <p><img src="zhimg.com/v2-a7fc1a447190146b2b9f773834c38d9d_r.jpg" alt="中间大的坐标系是世界坐标系，每一个小的坐标系对应一个相机的局部坐标系。红绿蓝(RGB)轴分别代表XYZ轴"></p></div> <footer class="page-edit" style="display:none;"><div class="edit-link"><a href="https://github.com/yindaheng98/Notebook/edit/master/学习笔记/图形学/相机代码.md" target="_blank" rel="noopener noreferrer">帮助我们改善此页面！</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">创建于: </span> <span class="time">2023-11-14 23:52:15</span></div> <br> <div class="last-updated"><span class="prefix">更新于: </span> <span class="time">2024-08-25 01:18:37</span></div></footer> <!----> <!----></main> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-44bd5a18 data-v-44bd5a18><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-44bd5a18><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-44bd5a18></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-44bd5a18></path></svg></div></div></div>
    <script src="/assets/js/app.1c89d7eb.js" defer></script><script src="/assets/js/3.63b8c0eb.js" defer></script><script src="/assets/js/1.be3d2055.js" defer></script><script src="/assets/js/195.f41818b6.js" defer></script>
  </body>
</html>
