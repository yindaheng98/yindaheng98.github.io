(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{592:function(s,t,a){s.exports=a.p+"assets/img/get_vpx_encoder_by_name.e5010fed.png"},593:function(s,t,a){s.exports=a.p+"assets/img/vpx_codec_vp9_cx.4c4338c1.png"},594:function(s,t,a){s.exports=a.p+"assets/img/vpx_img_alloc.fea14fcb.png"},595:function(s,t,a){s.exports=a.p+"assets/img/vpx_image.e8121b61.png"},596:function(s,t,a){s.exports=a.p+"assets/img/vpx_codec_enc_config_default.43ad8fe5.png"},597:function(s,t,a){s.exports=a.p+"assets/img/vpx_video_writer_open.0ca5f1a1.png"},598:function(s,t,a){s.exports=a.p+"assets/img/vpx_codec_enc_init.47197d40.png"},599:function(s,t,a){s.exports=a.p+"assets/img/vpx_codec_enc_init_ver.12facf64.png"},600:function(s,t,a){s.exports=a.p+"assets/img/vpx_img_read.2d402a78.png"},601:function(s,t,a){s.exports=a.p+"assets/img/vpx_codec_encode.5494ded6.png"},970:function(s,t,a){"use strict";a.r(t);var n=a(4),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("div",{staticClass:"language-c line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-c"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*\n *  Copyright (c) 2010 The WebM project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree. An additional intellectual property rights grant can be found\n *  in the file PATENTS.  All contributing project authors may\n *  be found in the AUTHORS file in the root of the source tree.\n */")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("h1",{attrs:{id:"开头自带的说明书"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#开头自带的说明书"}},[s._v("#")]),s._v(" 开头自带的说明书")]),s._v(" "),n("div",{staticClass:"language-c line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-c"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Simple Encoder")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ==============")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// This is an example of a simple encoder loop. It takes an input file in")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// YV12 format, passes it through the encoder, and writes the compressed")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// frames to disk in IVF format. Other decoder examples build upon this")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// one.")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("p",[s._v("这个例程的功能是读取YV12格式的输入，经过编码后以IVF格式保存。")]),s._v(" "),n("div",{staticClass:"language-c line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-c"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// The details of the IVF format have been elided from this example for")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// simplicity of presentation, as IVF files will not generally be used by")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// your application. In general, an IVF file consists of a file header,")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// followed by a variable number of frames. Each frame consists of a frame")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// header followed by a variable length payload. The length of the payload")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// is specified in the first four bytes of the frame header. The payload is")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// the raw compressed data.")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("p",[s._v("IVF格式的详情不是本示例的重点。")]),s._v(" "),n("div",{staticClass:"language-c line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-c"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Standard Includes")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// -----------------")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// For encoders, you only have to include `vpx_encoder.h` and then any")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// header files for the specific codecs you use. In this case, we're using")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// vp8.")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("p",[s._v("为了调用编码器，需要引入"),n("code",[s._v("vpx_encoder.h")]),s._v("。")]),s._v(" "),n("div",{staticClass:"language-c line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-c"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Getting The Default Configuration")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ---------------------------------")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v('// Encoders have the notion of "usage profiles." For example, an encoder')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// may want to publish default configurations for both a video")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// conferencing application and a best quality offline encoder. These")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// obviously have very different default settings. Consult the")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// documentation for your codec to see if it provides any default")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// configurations. All codecs provide a default configuration, number 0,")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// which is valid for material in the vacinity of QCIF/QVGA.")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br")])]),n("p",[s._v("在解码器中“配置”的过程可能不那么重要，但在编码器中，合适的“配置”非常重要。")]),s._v(" "),n("p",[s._v("编码器中有“配置文件”的概念。例如，在线视频会议应用程序中的编码器和需要最佳质量的离线编码器，不同的应用常场景显然需要用到不同的默认配置。")]),s._v(" "),n("div",{staticClass:"language-c line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-c"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Updating The Configuration")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ---------------------------------")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Almost all applications will want to update the default configuration")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// with settings specific to their usage. Here we set the width and height")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// of the video file to that specified on the command line. We also scale")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// the default bitrate based on the ratio between the default resolution")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// and the resolution specified on the command line.")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("p",[s._v("本例程在命令行中设置编码器编码时的图像尺寸，并且还根据默认分辨率和命令行中指定的分辨率之间的比率缩放默认比特率。")]),s._v(" "),n("div",{staticClass:"language-c line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-c"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Initializing The Codec")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ----------------------")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// The encoder is initialized by the following code.")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[s._v("初始化过程用到了"),n("code",[s._v("vpx_codec_enc_init")]),s._v("。")]),s._v(" "),n("div",{staticClass:"language-c line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-c"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Encoding A Frame")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ----------------")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// The frame is read as a continuous block (size width * height * 3 / 2)")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// from the input file. If a frame was read (the input file has not hit")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// EOF) then the frame is passed to the encoder. Otherwise, a NULL")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// is passed, indicating the End-Of-Stream condition to the encoder. The")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// `frame_cnt` is reused as the presentation time stamp (PTS) and each")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// frame is shown for one frame-time in duration. The flags parameter is")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// unused in this example. The deadline is set to VPX_DL_REALTIME to")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// make the example run as quickly as possible.")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br")])]),n("p",[s._v("帧是作为一个个连续的块进行读取的，当输入文件结束时，传一个空指针就能让编码器知道编码结束。")]),s._v(" "),n("p",[s._v("对于编码时的flag，本例程只用了"),n("code",[s._v("VPX_DL_GOOD_QUALITY")]),s._v("，还有很多其他的flag。"),n("code",[s._v("VPX_DL_")]),s._v("开头的这些flag是平衡编码质量和编码速度的，如果需要运行速度可以换成"),n("code",[s._v("VPX_DL_REALTIME")])]),s._v(" "),n("p",[s._v("PS："),n("code",[s._v("frame_cnt")]),s._v("这里是什么意思？没理解")]),s._v(" "),n("div",{staticClass:"language-c line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-c"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Forced Keyframes")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ----------------")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Keyframes can be forced by setting the VPX_EFLAG_FORCE_KF bit of the")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// flags passed to `vpx_codec_control()`. In this example, we force a")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// keyframe every <keyframe-interval> frames. Note, the output stream can")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// contain additional keyframes beyond those that have been forced using the")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// VPX_EFLAG_FORCE_KF flag because of automatic keyframe placement by the")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// encoder.")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("p",[s._v("在编码函数里时传入"),n("code",[s._v("VPX_EFLAG_FORCE_KF")]),s._v("强制让当前帧成为关键帧，强制关键帧不会影响原本自动产生的关键帧，只会让输出流中多一些关键帧的数据。")]),s._v(" "),n("p",[s._v("本例程中每隔几帧就会像这样搞一个强制关键帧。")]),s._v(" "),n("div",{staticClass:"language-c line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-c"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Processing The Encoded Data")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ---------------------------")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Each packet of type `VPX_CODEC_CX_FRAME_PKT` contains the encoded data")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// for this frame. We write a IVF frame header, followed by the raw data.")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[s._v("编码的输出是一个个pkt（包），在本例程中是IVF格式。")]),s._v(" "),n("div",{staticClass:"language-c line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-c"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Cleanup")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// -------")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// The `vpx_codec_destroy` call frees any memory allocated by the codec.")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Error Handling")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// --------------")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// This example does not special case any error return codes. If there was")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// an error, a descriptive message is printed and the program exits. With")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// few exeptions, vpx_codec functions return an enumerated error status,")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// with the value `0` indicating success.")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("p",[n("code",[s._v("vpx_codec_destroy")]),s._v("用于清理。")]),s._v(" "),n("p",[s._v("本示例中没有什么特殊的需要处理的错误。")]),s._v(" "),n("div",{staticClass:"language-c line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-c"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Error Resiliency Features")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// -------------------------")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Error resiliency is controlled by the g_error_resilient member of the")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// configuration structure. Use the `decode_with_drops` example to decode with")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// frames 5-10 dropped. Compare the output for a file encoded with this example")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// versus one encoded with the `simple_encoder` example.")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("p",[s._v("容错性机制由编码器配置中的"),n("code",[s._v("g_error_resilient")]),s._v("成员控制把这个案例和"),n("a",{attrs:{href:"https://github.com/webmproject/libvpx/blob/master/examples/decode_with_drops.c",target:"_blank",rel:"noopener noreferrer"}},[n("code",[s._v("decode_with_drops")]),n("OutboundLink")],1),s._v("进行比较就能知道这是干嘛用的。")]),s._v(" "),n("h2",{attrs:{id:"正文开头"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#正文开头"}},[s._v("#")]),s._v(" 正文开头")]),s._v(" "),n("div",{staticClass:"language-c line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-c"}},[n("code",[n("span",{pre:!0,attrs:{class:"token macro property"}},[s._v("#"),n("span",{pre:!0,attrs:{class:"token directive keyword"}},[s._v("include")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("<stdio.h>")])]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token macro property"}},[s._v("#"),n("span",{pre:!0,attrs:{class:"token directive keyword"}},[s._v("include")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("<stdlib.h>")])]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token macro property"}},[s._v("#"),n("span",{pre:!0,attrs:{class:"token directive keyword"}},[s._v("include")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("<string.h>")])]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token macro property"}},[s._v("#"),n("span",{pre:!0,attrs:{class:"token directive keyword"}},[s._v("include")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"vpx/vpx_encoder.h"')])]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token macro property"}},[s._v("#"),n("span",{pre:!0,attrs:{class:"token directive keyword"}},[s._v("include")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"../tools_common.h"')])]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token macro property"}},[s._v("#"),n("span",{pre:!0,attrs:{class:"token directive keyword"}},[s._v("include")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"../video_writer.h"')])]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("p",[s._v("一堆"),n("code",[s._v("include")]),s._v("不用多讲。")]),s._v(" "),n("div",{staticClass:"language-c line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-c"}},[n("code",[s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("char")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("exec_name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("usage_exit")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("fprintf")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("stderr")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n          "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Usage: %s <codec> <width> <height> <infile> <outfile> "')]),s._v("\n          "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"<keyframe-interval> <error-resilient> <frames to encode>\\n"')]),s._v("\n          "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"See comments in simple_encoder.c for more information.\\n"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n          exec_name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("exit")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("EXIT_FAILURE"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("p",[s._v("这是一个输出错误并退出程序的函数，用在接下来会经常见到的"),n("code",[s._v("die")]),s._v("函数里面，就是输出一些错误而已，不用太在意。")]),s._v(" "),n("h2",{attrs:{id:""}},[n("a",{staticClass:"header-anchor",attrs:{href:"#"}},[s._v("#")])]),s._v(" "),n("div",{staticClass:"language-c line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-c"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("encode_frame")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("vpx_codec_ctx_t "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("codec"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" vpx_image_t "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("img"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" frame_index"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" flags"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" VpxVideoWriter "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("writer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("p",[s._v("从名称上看，这个就是对帧进行编码的函数，后面再解释。")]),s._v(" "),n("div",{staticClass:"language-c line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-c"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// TODO(tomfinegan): Improve command line parsing and add args for bitrate/fps.")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("main")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" argc"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("char")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("argv"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("p",[s._v("主函数开始。")]),s._v(" "),n("div",{staticClass:"language-c line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-c"}},[n("code",[s._v("  FILE "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("infile "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NULL")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  vpx_codec_ctx_t codec"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  vpx_codec_enc_cfg_t cfg"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" frame_count "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  vpx_image_t raw"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  vpx_codec_err_t res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  VpxVideoInfo info "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  VpxVideoWriter "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("writer "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NULL")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" VpxInterface "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("encoder "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NULL")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" fps "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" bitrate "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" keyframe_interval "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" max_frames "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" frames_encoded "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("char")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("codec_arg "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NULL")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("char")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("width_arg "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NULL")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("char")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("height_arg "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NULL")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("char")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("infile_arg "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NULL")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("char")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("outfile_arg "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NULL")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("char")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("keyframe_interval_arg "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NULL")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n  exec_name "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" argv"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("argc "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("die")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Invalid number of arguments"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br")])]),n("p",[s._v("一堆后面要用到的变量定义。")]),s._v(" "),n("p",[s._v("注意到帧率和比特率都是在这固定好的。")]),s._v(" "),n("div",{staticClass:"language-c line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-c"}},[n("code",[s._v("  codec_arg "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" argv"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  width_arg "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" argv"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  height_arg "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" argv"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  infile_arg "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" argv"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  outfile_arg "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" argv"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  keyframe_interval_arg "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" argv"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  max_frames "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("strtol")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("argv"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NULL")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("p",[s._v("结合上面的变量定义，和"),n("RouterLink",{attrs:{to:"/视频编解码/libvpx-simple_decoder.html"}},[s._v("《"),n("code",[s._v("libvpx")]),s._v("的使用方法简析 - simple_decoder.c》")]),s._v("里的解码器例程一对比，发现所需的设置和命令行参数多了不少，看来libvpx的编码过程比解码复杂很多。")],1),s._v(" "),n("h2",{attrs:{id:"获取所需的编码器"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#获取所需的编码器"}},[s._v("#")]),s._v(" 获取所需的编码器")]),s._v(" "),n("div",{staticClass:"language-c line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-c"}},[n("code",[s._v("  encoder "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("get_vpx_encoder_by_name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("codec_arg"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("encoder"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("die")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Unsupported codec."')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("p",[s._v("这里用命令行里传入的参数查找了编码器，看看这个"),n("code",[s._v("get_vpx_encoder_by_name")]),s._v("是怎么找编码器的：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(592),alt:""}})]),s._v(" "),n("p",[s._v("和"),n("RouterLink",{attrs:{to:"/视频编解码/libvpx-simple_decoder.html"}},[s._v("《"),n("code",[s._v("libvpx")]),s._v("的使用方法简析 - simple_decoder.c》")]),s._v("里面介绍的"),n("code",[s._v("get_vpx_decoder_by_fourcc")]),s._v("基本没什么差别，返回的也都是这个"),n("code",[s._v("VpxInterface")]),s._v("，不用多讲，不懂的看"),n("RouterLink",{attrs:{to:"/视频编解码/libvpx-simple_decoder.html"}},[s._v("《"),n("code",[s._v("libvpx")]),s._v("的使用方法简析 - simple_decoder.c》")]),s._v("即可。而且这段代码就在"),n("code",[s._v("get_vpx_decoder_by_fourcc")]),s._v("的上面，它们都在"),n("code",[s._v("tools_common.c")]),s._v("里。")],1),s._v(" "),n("p",[s._v("这个"),n("code",[s._v("vpx_codec_vp9_cx")]),s._v("的定义也和"),n("RouterLink",{attrs:{to:"/视频编解码/libvpx-simple_decoder.html"}},[s._v("《"),n("code",[s._v("libvpx")]),s._v("的使用方法简析 - simple_decoder.c》")]),s._v("里"),n("code",[s._v("vpx_codec_vp9_dx")]),s._v("的定义方式差不多：")],1),s._v(" "),n("p",[n("img",{attrs:{src:a(593),alt:""}})]),s._v(" "),n("p",[s._v("区别只在于"),n("code",[s._v("vpx_codec_vp9_dx")]),s._v("初始化的都是解码器"),n("code",[s._v("dec")]),s._v("那边的函数，"),n("code",[s._v("vpx_codec_vp9_cx")]),s._v("初始化的都是编码器"),n("code",[s._v("enc")]),s._v("那边的函数")]),s._v(" "),n("div",{staticClass:"language-c line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-c"}},[n("code",[s._v("  info"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("codec_fourcc "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" encoder"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v("fourcc"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  info"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("frame_width "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("strtol")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("width_arg"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NULL")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  info"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("frame_height "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("strtol")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("height_arg"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NULL")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  info"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("time_base"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("numerator "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  info"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("time_base"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("denominator "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" fps"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("info"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("frame_width "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" info"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("frame_height "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("info"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("frame_width "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("info"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("frame_height "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("die")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Invalid frame size: %dx%d"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" info"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("frame_width"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" info"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("frame_height"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br")])]),n("p",[s._v("获取到了编码器之后还给前面定义的"),n("code",[s._v("VpxVideoInfo")]),s._v("类型的变量赋了一堆值，可以看到前面定义的"),n("code",[s._v("fps")]),s._v("和一些命令行里指定的值都赋进去了。")]),s._v(" "),n("h2",{attrs:{id:"给即将到来的帧分配内存空间"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#给即将到来的帧分配内存空间"}},[s._v("#")]),s._v(" 给即将到来的帧分配内存空间")]),s._v(" "),n("div",{staticClass:"language-c line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-c"}},[n("code",[s._v("  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("vpx_img_alloc")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("raw"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" VPX_IMG_FMT_I420"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" info"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("frame_width"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                     info"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("frame_height"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("die")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Failed to allocate image."')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[s._v("这个函数长这样：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(594),alt:""}})]),s._v(" "),n("p",[s._v("这里传入的"),n("code",[s._v("vpx_image_t *img")]),s._v("应该就是一个存储帧数据的结构体，其定义如下：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(595),alt:""}})]),s._v(" "),n("p",[s._v("有很多的元数据啊，不过一看便知，这个"),n("code",[s._v("img_data")]),s._v("就是存帧数据的地方，"),n("code",[s._v("vpx_img_alloc")]),s._v("应该就是请求一段内存空间然后把指针赋值给这个结构体成员。")]),s._v(" "),n("p",[s._v("具体请求大呢？这应该是通过后面几个参数计算出来的。从例程里的传入看，这个"),n("code",[s._v("fmt")]),s._v("应该是帧数据格式，后面三个是长宽和对齐方式。这样，函数知道了像素数据的存储格式和长宽还有对齐方式，就能计算所需的内存空间大小了。")]),s._v(" "),n("h2",{attrs:{id:"生成一个配置项"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#生成一个配置项"}},[s._v("#")]),s._v(" 生成一个配置项")]),s._v(" "),n("div",{staticClass:"language-c line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-c"}},[n("code",[s._v("  keyframe_interval "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("strtol")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("keyframe_interval_arg"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NULL")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("keyframe_interval "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("die")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Invalid keyframe interval value."')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("p",[s._v("首先获取了一下"),n("code",[s._v("keyframe_interval")]),s._v("，这应该就是开头说明里讲的强制关键帧的固定间隔。")]),s._v(" "),n("div",{staticClass:"language-c line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-c"}},[n("code",[s._v("  "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("printf")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Using %s\\n"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("vpx_codec_iface_name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("encoder"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("codec_interface")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("输出了编码器的名字。")]),s._v(" "),n("div",{staticClass:"language-c line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-c"}},[n("code",[s._v("  res "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("vpx_codec_enc_config_default")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("encoder"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("codec_interface")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("cfg"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("die_codec")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("codec"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Failed to get default codec config."')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("p",[s._v("这个"),n("code",[s._v("vpx_codec_enc_config_default")]),s._v("看着像是给编码器配置上了默认值。这个函数长这样：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(596),alt:""}})]),s._v(" "),n("p",[s._v("就是把传入的"),n("code",[s._v("iface")]),s._v("里面的一个结构体"),n("code",[s._v("iface->enc.cfg_maps->cfg")]),s._v("赋值给传入的"),n("code",[s._v("cfg")]),s._v("指针所指向的内存空间。")]),s._v(" "),n("p",[s._v("按照这种赋值方式，对这个配置项的赋值和修改显然不会影响到"),n("code",[s._v("iface->enc.cfg_maps->cfg")]),s._v("里的值，所以这个函数应该是给一个包含默认配置的模板，让用户修改之后传给其他的函数用于一些初始化操作，而不是用于直接控制"),n("code",[s._v("iface")]),s._v("的配置。")]),s._v(" "),n("div",{staticClass:"language-c line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-c"}},[n("code",[s._v("  cfg"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("g_w "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" info"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("frame_width"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  cfg"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("g_h "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" info"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("frame_height"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  cfg"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("g_timebase"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("num "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" info"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("time_base"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("numerator"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  cfg"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("g_timebase"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("den "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" info"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("time_base"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("denominator"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  cfg"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("rc_target_bitrate "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" bitrate"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  cfg"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("g_error_resilient "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("vpx_codec_er_flags_t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("strtoul")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("argv"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NULL")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("p",[s._v("这个默认配置输出出来了之后就把前面赋值好的一堆帧长宽之类的变量给设置进去了。")]),s._v(" "),n("h2",{attrs:{id:"打开文件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#打开文件"}},[s._v("#")]),s._v(" 打开文件")]),s._v(" "),n("div",{staticClass:"language-c line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-c"}},[n("code",[s._v("  writer "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("vpx_video_writer_open")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("outfile_arg"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" kContainerIVF"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("info"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("writer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("die")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Failed to open %s for writing."')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" outfile_arg"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("infile "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("fopen")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("infile_arg"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"rb"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("die")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Failed to open %s for reading."')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" infile_arg"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[s._v("调用了"),n("code",[s._v("vpx_video_writer_open")]),s._v("，看这名字应该是用于写入编码后的数据。下面的"),n("code",[s._v("fopen")]),s._v("应该就是输入的无压缩帧数据了。")]),s._v(" "),n("p",[s._v("这个"),n("code",[s._v("vpx_video_writer_open")]),s._v("长这样：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(597),alt:""}})]),s._v(" "),n("p",[s._v("也就是打开文件然后赋值给一个"),n("code",[s._v("VpxVideoWriter")]),s._v("，没什么特殊的。")]),s._v(" "),n("h2",{attrs:{id:"编码器初始化"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#编码器初始化"}},[s._v("#")]),s._v(" 编码器初始化")]),s._v(" "),n("div",{staticClass:"language-c line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-c"}},[n("code",[s._v("  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("vpx_codec_enc_init")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("codec"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" encoder"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("codec_interface")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("cfg"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("die")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Failed to initialize encoder"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("p",[s._v("前面看到的"),n("code",[s._v("cfg")]),s._v("果然是用到了初始化里面。")]),s._v(" "),n("p",[s._v("看看这个"),n("code",[s._v("vpx_codec_enc_init")]),s._v("：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(598),alt:""}})]),s._v(" "),n("p",[s._v("不出所料和"),n("RouterLink",{attrs:{to:"/视频编解码/libvpx-simple_decoder.html"}},[s._v("《"),n("code",[s._v("libvpx")]),s._v("的使用方法简析 - simple_decoder.c》")]),s._v("里介绍的"),n("code",[s._v("vpx_codec_dec_init")]),s._v("一样都是宏封装了一个函数：")],1),s._v(" "),n("p",[n("img",{attrs:{src:a(599),alt:""}})]),s._v(" "),n("p",[s._v("不仔细看甚至都找不出来和"),n("code",[s._v("vpx_codec_dec_init_ver")]),s._v("有什么差别。")]),s._v(" "),n("h2",{attrs:{id:"编码过程"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#编码过程"}},[s._v("#")]),s._v(" 编码过程")]),s._v(" "),n("div",{staticClass:"language-c line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-c"}},[n("code",[s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Encode frames.")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("vpx_img_read")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("raw"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" infile"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" flags "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("keyframe_interval "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" frame_count "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v(" keyframe_interval "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n      flags "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|=")]),s._v(" VPX_EFLAG_FORCE_KF"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("encode_frame")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("codec"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("raw"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" frame_count"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" flags"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" writer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    frames_encoded"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("max_frames "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" frames_encoded "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">=")]),s._v(" max_frames"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("break")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("p",[s._v("就是不断的调用"),n("code",[s._v("vpx_img_read")]),s._v("读帧数据然后传给"),n("code",[s._v("encode_frame")]),s._v("去编码。然后就是按照开头说明里讲的，每隔"),n("code",[s._v("keyframe_interval")]),s._v("帧传入一个"),n("code",[s._v("VPX_EFLAG_FORCE_KF")]),s._v("的flag产生强制关键帧。")]),s._v(" "),n("p",[s._v("这个"),n("code",[s._v("vpx_img_read")]),s._v("函数长这样：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(600),alt:""}})]),s._v(" "),n("p",[s._v("应该是每个帧有三个通道("),n("code",[s._v("plane")]),s._v(")，每个通道数据顺序排列，然后通道内的数据是一行一行的像素数据按顺序排列，然后就按照这个规则执行"),n("code",[s._v("fread")]),s._v("把数据读进buffer里即可。")]),s._v(" "),n("div",{staticClass:"language-c line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-c"}},[n("code",[s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Flush encoder.")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("encode_frame")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("codec"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NULL")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" writer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("p",[s._v("最后一帧输入进去之后还会出来几个压缩包，最后把剩下的这些包也处理完。")]),s._v(" "),n("h2",{attrs:{id:"收尾"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#收尾"}},[s._v("#")]),s._v(" 收尾")]),s._v(" "),n("div",{staticClass:"language-c line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-c"}},[n("code",[s._v("  "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("printf")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\\n"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("fclose")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("infile"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("printf")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Processed %d frames.\\n"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" frame_count"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("vpx_img_free")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("raw"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("vpx_codec_destroy")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("codec"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("die_codec")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("codec"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Failed to destroy codec."')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("vpx_video_writer_close")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("writer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" EXIT_SUCCESS"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("p",[n("code",[s._v("vpx_img_free")]),s._v("释放内存、"),n("code",[s._v("vpx_codec_destroy")]),s._v("销毁编码器、"),n("code",[s._v("vpx_video_writer_close")]),s._v("关闭文件，不用多讲。")]),s._v(" "),n("h2",{attrs:{id:"encode-frame"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#encode-frame"}},[s._v("#")]),s._v(" "),n("code",[s._v("encode_frame")])]),s._v(" "),n("p",[s._v("是时候解析"),n("code",[s._v("encode_frame")]),s._v("函数了：")]),s._v(" "),n("div",{staticClass:"language-c line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-c"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("encode_frame")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("vpx_codec_ctx_t "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("codec"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" vpx_image_t "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("img"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" frame_index"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" flags"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" VpxVideoWriter "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("writer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" got_pkts "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  vpx_codec_iter_t iter "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NULL")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" vpx_codec_cx_pkt_t "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("pkt "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NULL")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" vpx_codec_err_t res "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("vpx_codec_encode")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("codec"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" img"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" frame_index"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" flags"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" VPX_DL_GOOD_QUALITY"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("res "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" VPX_CODEC_OK"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("die_codec")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("codec"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Failed to encode frame"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("pkt "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("vpx_codec_get_cx_data")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("codec"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("iter"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NULL")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    got_pkts "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("pkt"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v("kind "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" VPX_CODEC_CX_FRAME_PKT"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" keyframe "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("pkt"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("frame"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("flags "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v(" VPX_FRAME_IS_KEY"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("vpx_video_writer_write_frame")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("writer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" pkt"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("frame"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("buf"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                                        pkt"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("frame"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sz"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                                        pkt"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("frame"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pts"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("die_codec")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("codec"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Failed to write compressed frame"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("printf")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("keyframe "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"K"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"."')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("fflush")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("stdout")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" got_pkts"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br")])]),n("p",[s._v("其实也不复杂，就是调用"),n("code",[s._v("vpx_codec_encode")]),s._v("对帧进行编码，然后调用"),n("code",[s._v("vpx_codec_get_cx_data")]),s._v("获取编码压缩后的压缩包，然后用"),n("code",[s._v("vpx_video_writer_write_frame")]),s._v("写入文件。")]),s._v(" "),n("p",[s._v("可以看到和"),n("RouterLink",{attrs:{to:"/视频编解码/libvpx-simple_decoder.html"}},[s._v("《"),n("code",[s._v("libvpx")]),s._v("的使用方法简析 - simple_decoder.c》")]),s._v("里的解码过程有异曲同工之妙。只不过编码时一个帧会编码出多个压缩包，然后还有输出是否是关键帧的步骤，所以稍微复杂一点。")],1),s._v(" "),n("p",[s._v("具体来看这个"),n("code",[s._v("vpx_codec_encode")]),s._v("：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(601),alt:""}})]),s._v(" "),n("p",[s._v("前面都和"),n("RouterLink",{attrs:{to:"/视频编解码/libvpx-simple_decoder.html"}},[s._v("《"),n("code",[s._v("libvpx")]),s._v("的使用方法简析 - simple_decoder.c》")]),s._v("里介绍的解码器差不多，本质上就是调用"),n("code",[s._v("vpx_codec_iface")]),s._v("接口里定义好的编码函数"),n("code",[s._v("enc.encode")]),s._v("。但是这个编码器后面多了一个“Multi-resolution encoding”？先码住，以后学习一下看看是什么东西。")],1),s._v(" "),n("p",[s._v("再看看这个输出压缩包的"),n("code",[s._v("vpx_codec_get_cx_data")]),s._v("：")]),s._v(" "),n("div",{staticClass:"language-c line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-c"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" vpx_codec_cx_pkt_t "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("vpx_codec_get_cx_data")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("vpx_codec_ctx_t "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("ctx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                                                vpx_codec_iter_t "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("iter"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" vpx_codec_cx_pkt_t "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("pkt "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NULL")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ctx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("iter"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n      ctx"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v("err "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" VPX_CODEC_INVALID_PARAM"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("ctx"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v("iface "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("ctx"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v("priv"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n      ctx"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v("err "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" VPX_CODEC_ERROR"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ctx"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v("iface"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v("caps "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v(" VPX_CODEC_CAP_ENCODER"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n      ctx"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v("err "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" VPX_CODEC_INCAPABLE"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v("\n      pkt "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ctx"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v("iface"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v("enc"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("get_cx_data")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("get_alg_priv")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ctx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" iter"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("pkt "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" pkt"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v("kind "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" VPX_CODEC_CX_FRAME_PKT"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// If the application has specified a destination area for the")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// compressed data, and the codec has not placed the data there,")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// and it fits, copy it.")]),s._v("\n    vpx_codec_priv_t "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" priv "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ctx"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v("priv"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//ctx->priv是用于在框架内部改变的值")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("char")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" dst_buf "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("char")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("priv"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v("enc"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cx_data_dst_buf"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("buf"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//把一个buf赋值给dst_buf。应该是注释里写的destination area for the compressed data")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("dst_buf "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" pkt"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("raw"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("buf "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" dst_buf "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//先判断这个dst_buf和pkt里存数据的buf不是同一个")]),s._v("\n        pkt"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("raw"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sz "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" priv"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v("enc"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cx_data_pad_before "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("\n                priv"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v("enc"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cx_data_pad_after "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<=")]),s._v("\n            priv"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v("enc"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cx_data_dst_buf"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sz"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//再判断这个buf存得下ptk里的数据")]),s._v("\n      vpx_codec_cx_pkt_t "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("modified_pkt "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("priv"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v("enc"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cx_data_pkt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n      "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("memcpy")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("dst_buf "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" priv"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v("enc"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cx_data_pad_before"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" pkt"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("raw"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("buf"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n             pkt"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("raw"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sz"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//把pkt里的数据拷贝进dst_buf里")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("modified_pkt "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("pkt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      modified_pkt"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("raw"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("buf "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" dst_buf"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      modified_pkt"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("raw"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sz "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+=")]),s._v("\n          priv"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v("enc"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cx_data_pad_before "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" priv"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v("enc"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cx_data_pad_after"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      pkt "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" modified_pkt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//然后再把dst_buf赋值回pkt里")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//如果无法拷贝？")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("dst_buf "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" pkt"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("raw"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("buf"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" \n      priv"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v("enc"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cx_data_dst_buf"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("buf "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" dst_buf "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" pkt"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("raw"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sz"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      priv"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v("enc"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cx_data_dst_buf"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sz "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-=")]),s._v(" pkt"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("raw"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sz"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" pkt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br")])]),n("p",[s._v("前面也都和"),n("RouterLink",{attrs:{to:"/视频编解码/libvpx-simple_decoder.html"}},[s._v("《"),n("code",[s._v("libvpx")]),s._v("的使用方法简析 - simple_decoder.c》")]),s._v("里介绍的解码器差不多，本质上就是调用"),n("code",[s._v("vpx_codec_iface")]),s._v("接口里定义好的编码函数"),n("code",[s._v("enc.get_cx_data")]),s._v("。然后后面也多了一段不太理解的内容，看逻辑是把压缩包数据拷到别的地方，先码住，以后再看看这个操作是为什么存在。")],1),s._v(" "),n("p",[s._v("PS：注意到有个传入的迭代器参数"),n("code",[s._v("iter")]),s._v("在"),n("code",[s._v("ctx->iface->enc.get_cx_data(get_alg_priv(ctx), iter)")]),s._v("里用上了，但是没有其他任何操作。这个参数是历史遗留问题，具体可以看"),n("code",[s._v("decoder_get_frame")]),s._v("函数里面有一段注释的解释，"),n("RouterLink",{attrs:{to:"/视频编解码/libvpx-insight.html"}},[s._v("《"),n("code",[s._v("libvpx")]),s._v("再深入一点》")]),s._v("的解析里也有。")],1)])}),[],!1,null,null,null);t.default=e.exports}}]);