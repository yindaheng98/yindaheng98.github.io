(window.webpackJsonp=window.webpackJsonp||[]).push([[111],{782:function(t,n,e){"use strict";e.r(n);var s=e(4),a=Object(s.a)({},(function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h2",{attrs:{id:"初始化：newpeerconnection"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#初始化：newpeerconnection"}},[t._v("#")]),t._v(" 初始化："),e("code",[t._v("NewPeerConnection")])]),t._v(" "),e("p",[t._v("本节主要讲解WebRTC标准接口"),e("code",[t._v("NewPeerConnection")]),t._v("内部和调用前所需要进行的interceptor初始化操作。在开始前，你首先需要去"),e("RouterLink",{attrs:{to:"/WebRTC/rtp-forwarder.html"}},[t._v("《用实例学习pion - "),e("code",[t._v("rtp-forwarder")]),t._v("》")]),t._v("和"),e("RouterLink",{attrs:{to:"/WebRTC/传入总结.html"}},[t._v("《pion学习总结：等待传入track的一般流程》")]),t._v("里看看"),e("code",[t._v("NewPeerConnection")]),t._v("的用法以及在调用"),e("code",[t._v("NewPeerConnection")]),t._v("前所需要进行的操作；然后你还需要理解"),e("RouterLink",{attrs:{to:"/WebRTC/pion-interceptor.html"}},[t._v("《pion/interceptor浅析》")]),t._v("中关于级联的思想和"),e("RouterLink",{attrs:{to:"/WebRTC/pion-nack.html"}},[t._v("《用实例学习pion interceptor - "),e("code",[t._v("nack")]),t._v("》")]),t._v("里出现的"),e("code",[t._v("interceptor.NewChain")]),t._v("是什么。")],1),t._v(" "),e("h3",{attrs:{id:"在newpeerconnection之前"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#在newpeerconnection之前"}},[t._v("#")]),t._v(" 在"),e("code",[t._v("NewPeerConnection")]),t._v("之前")]),t._v(" "),e("p",[t._v("从"),e("RouterLink",{attrs:{to:"/WebRTC/rtp-forwarder.html"}},[t._v("《用实例学习pion - "),e("code",[t._v("rtp-forwarder")]),t._v("》")]),t._v("中可以看到，在正式调用"),e("code",[t._v("api.NewPeerConnection")]),t._v("之前，与"),e("code",[t._v("pion/interceptor")]),t._v("有关的操作主要就是创建"),e("code",[t._v("interceptor.Registry")]),t._v("并调用"),e("code",[t._v("webrtc.NewAPI")]),t._v("创建WebRTC标准API。这个"),e("code",[t._v("interceptor.Registry")]),t._v("非常之简单：")],1),t._v(" "),e("div",{staticClass:"language-go line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-go"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Registry is a collector for interceptors.")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(" Registry "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("struct")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tinterceptors "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("Interceptor\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Add adds a new Interceptor to the registry.")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("i "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("Registry"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Add")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("icpr Interceptor"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\ti"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("interceptors "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("append")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("i"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("interceptors"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" icpr"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Build constructs a single Interceptor from a InterceptorRegistry")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("i "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("Registry"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Build")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" Interceptor "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("len")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("i"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("interceptors"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("NoOp"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\t"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("NewChain")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("i"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("interceptors"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br"),e("span",{staticClass:"line-number"},[t._v("6")]),e("br"),e("span",{staticClass:"line-number"},[t._v("7")]),e("br"),e("span",{staticClass:"line-number"},[t._v("8")]),e("br"),e("span",{staticClass:"line-number"},[t._v("9")]),e("br"),e("span",{staticClass:"line-number"},[t._v("10")]),e("br"),e("span",{staticClass:"line-number"},[t._v("11")]),e("br"),e("span",{staticClass:"line-number"},[t._v("12")]),e("br"),e("span",{staticClass:"line-number"},[t._v("13")]),e("br"),e("span",{staticClass:"line-number"},[t._v("14")]),e("br"),e("span",{staticClass:"line-number"},[t._v("15")]),e("br"),e("span",{staticClass:"line-number"},[t._v("16")]),e("br"),e("span",{staticClass:"line-number"},[t._v("17")]),e("br"),e("span",{staticClass:"line-number"},[t._v("18")]),e("br")])]),e("p",[t._v("可以看到，类方法就两个，一个"),e("code",[t._v("Add")]),t._v("就是添加，然后一个"),e("code",[t._v("Build")]),t._v("生成一个"),e("code",[t._v("interceptor.Chain")]),t._v("。所以这个"),e("code",[t._v("interceptor.Registry")]),t._v("的用处很明显就是构造interceptor的调用链。")]),t._v(" "),e("p",[t._v("从"),e("RouterLink",{attrs:{to:"/WebRTC/rtp-forwarder.html"}},[t._v("《用实例学习pion - "),e("code",[t._v("rtp-forwarder")]),t._v("》")]),t._v("中还可以看到，这个"),e("code",[t._v("interceptor.Registry")]),t._v("并不是直接输入到"),e("code",[t._v("webrtc.NewAPI")]),t._v("里的，而是先经过了一个"),e("code",[t._v("webrtc.WithInterceptorRegistry")]),t._v("，这个"),e("code",[t._v("webrtc.WithInterceptorRegistry")]),t._v("更是简单：")],1),t._v(" "),e("div",{staticClass:"language-go line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-go"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// WithInterceptorRegistry allows providing Interceptors to the API.")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Settings should not be changed after passing the registry to an API.")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("WithInterceptorRegistry")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("interceptorRegistry "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("interceptor"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Registry"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("a "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("API"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("a "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("API"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\ta"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("interceptor "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" interceptorRegistry"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Build")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br"),e("span",{staticClass:"line-number"},[t._v("6")]),e("br"),e("span",{staticClass:"line-number"},[t._v("7")]),e("br")])]),e("p",[t._v("直接就是调用上面那个"),e("code",[t._v("interceptor.Registry")]),t._v("里的"),e("code",[t._v("Build")]),t._v("函数。")]),t._v(" "),e("h3",{attrs:{id:"在newpeerconnection里"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#在newpeerconnection里"}},[t._v("#")]),t._v(" 在"),e("code",[t._v("NewPeerConnection")]),t._v("里")]),t._v(" "),e("p",[e("code",[t._v("NewPeerConnection")]),t._v("就是这个函数：")]),t._v(" "),e("div",{staticClass:"language-go line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-go"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("api "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("API"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("NewPeerConnection")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("configuration Configuration"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("PeerConnection"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("error")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br")])]),e("p",[t._v("在这个函数里与interceptor相关的就一句：")]),t._v(" "),e("div",{staticClass:"language-go line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-go"}},[e("code",[t._v("pc"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("interceptorRTCPWriter "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" api"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("interceptor"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("BindRTCPWriter")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("interceptor"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("RTCPWriterFunc")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("pc"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("writeRTCP"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br")])]),e("p",[t._v("显然这是给interceptor绑了一个实际进行RTCP写操作的函数"),e("code",[t._v("pc.writeRTCP")]),t._v("，这个函数显然是要负责把RTCP包发出去。返回的"),e("code",[t._v("RTCPWriter")]),t._v("被记录在了"),e("code",[t._v("pc.interceptorRTCPWriter")]),t._v("里。看看这个"),e("code",[t._v("pc.interceptorRTCPWriter")]),t._v("被调用的位置：")]),t._v(" "),e("div",{staticClass:"language-go line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-go"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// WriteRTCP sends a user provided RTCP packet to the connected peer. If no peer is connected the")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// packet is discarded. It also runs any configured interceptors.")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("pc "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("PeerConnection"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("WriteRTCP")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("pkts "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("rtcp"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Packet"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("error")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("_")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" err "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" pc"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("interceptorRTCPWriter"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Write")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("pkts"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("make")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("interceptor"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Attributes"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" err\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br"),e("span",{staticClass:"line-number"},[t._v("6")]),e("br")])]),e("p",[t._v("嗯，直接就是封装在"),e("code",[t._v("WriteRTCP")]),t._v("里，很符合直觉。看过"),e("RouterLink",{attrs:{to:"/WebRTC/pion-interceptor.html"}},[t._v("《pion/interceptor浅析》")]),t._v("和"),e("RouterLink",{attrs:{to:"/WebRTC/pion-nack.html"}},[t._v("《用实例学习pion interceptor - "),e("code",[t._v("nack")]),t._v("》")]),t._v("就能明白，系统需要的发送RTCP包的过程都已经封装在interceptor里了，不需要用户手动去调用，这里的"),e("code",[t._v("WriteRTCP")]),t._v("只是留给用户自定义RTCP发包过程调用的。")],1),t._v(" "),e("p",[t._v("最后当然也有关闭的操作，在"),e("code",[t._v("PeerConnection.Close")]),t._v("里，就是在关闭"),e("code",[t._v("PeerConnection")]),t._v("时要关闭interceptor，很好理解。")]),t._v(" "),e("h2",{attrs:{id:"中场休息"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#中场休息"}},[t._v("#")]),t._v(" 中场休息")]),t._v(" "),e("p",[t._v("截至目前，我们在"),e("code",[t._v("NewPeerConnection")]),t._v("找到了一堆初始化操作，我们看到：")]),t._v(" "),e("ul",[e("li",[e("code",[t._v("BindRTCPWriter")]),t._v("在"),e("code",[t._v("NewPeerConnection")]),t._v("里被调用，返回的"),e("code",[t._v("RTCPWriter.Write")]),t._v("在"),e("code",[t._v("PeerConnection")]),t._v("的"),e("code",[t._v("WriteRTCP")]),t._v("里调用，供用户发送一些自定义的RTCP包")])]),t._v(" "),e("p",[t._v("根据"),e("RouterLink",{attrs:{to:"/WebRTC/pion-interceptor.html"}},[t._v("《pion/interceptor浅析》")]),t._v("，还差"),e("code",[t._v("BindRTCPReader")]),t._v("、"),e("code",[t._v("BindRemoteStream")]),t._v("、"),e("code",[t._v("BindLocalStream")]),t._v("的相关操作没用找到。")],1),t._v(" "),e("h2",{attrs:{id:"准备好，要开始加速了"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#准备好，要开始加速了"}},[t._v("#")]),t._v(" 准备好，要开始加速了")]),t._v(" "),e("p",[t._v("在PeerConnection里，与RTP包收发相关的操作当属"),e("code",[t._v("AddTrack")]),t._v("和"),e("code",[t._v("OnTrack")]),t._v("。")]),t._v(" "),e("p",[t._v("其中，"),e("code",[t._v("AddTrack")]),t._v("接受一个"),e("code",[t._v("TrackLocal")]),t._v("，返回一个"),e("code",[t._v("RTPSender")]),t._v("：")]),t._v(" "),e("div",{staticClass:"language-go line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-go"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("pc "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("PeerConnection"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("AddTrack")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("track TrackLocal"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("RTPSender"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("error")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br")])]),e("p",[t._v("而"),e("code",[t._v("OnTrack")]),t._v("回调的输入也是一个"),e("code",[t._v("TrackRemote")]),t._v("和一个"),e("code",[t._v("RTPReceiver")]),t._v("：")]),t._v(" "),e("div",{staticClass:"language-go line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-go"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("pc "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("PeerConnection"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("OnTrack")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("f "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("TrackRemote"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("RTPReceiver"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br")])]),e("p",[t._v("一眼看去，两个函数，"),e("code",[t._v("AddTrack")]),t._v("主发，"),e("code",[t._v("OnTrack")]),t._v("主收，其输入输出参数遥相呼应。显然，他们之间必有共通之处。")]),t._v(" "),e("p",[t._v("顺着"),e("code",[t._v("AddTrack")]),t._v("和"),e("code",[t._v("OnTrack")]),t._v("深入一层，我们就来到了Track的领域，这里的主角是"),e("code",[t._v("TrackLocal")]),t._v("和"),e("code",[t._v("TrackRemote")]),t._v("，分别主导RTP发送和接收的过程。下面两篇文章分别从"),e("code",[t._v("TrackLocal")]),t._v("和"),e("code",[t._v("TrackRemote")]),t._v("入手，深挖interceptor在发送RTP包和接收RTP包的场景下的调用方式。在开始前，你首先需要去"),e("RouterLink",{attrs:{to:"/WebRTC/TrackLocal.html"}},[t._v("《pion中的"),e("code",[t._v("TrackLocal")]),t._v("》")]),t._v("和"),e("RouterLink",{attrs:{to:"/WebRTC/TrackRemote.html"}},[t._v("《pion中的"),e("code",[t._v("TrackRemote")]),t._v("》")]),t._v("里看看"),e("code",[t._v("TrackLocal")]),t._v("和"),e("code",[t._v("TrackRemote")]),t._v("是什么以及怎么用。")],1),t._v(" "),e("ul",[e("li",[e("p",[e("RouterLink",{attrs:{to:"/WebRTC/interceptor在tracklocal里.html"}},[t._v("《interceptor寻踪：从"),e("code",[t._v("TrackLocal")]),t._v("开始深入挖掘"),e("code",[t._v("pion/interceptor")]),t._v("的用法》")])],1)]),t._v(" "),e("li",[e("p",[e("RouterLink",{attrs:{to:"/WebRTC/interceptor在trackremote里.html"}},[t._v("《interceptor寻踪：从"),e("code",[t._v("TrackRemote")]),t._v("开始深入挖掘"),e("code",[t._v("pion/interceptor")]),t._v("的用法》")])],1)]),t._v(" "),e("li",[e("p",[e("RouterLink",{attrs:{to:"/WebRTC/interceptor总结.html"}},[t._v("《interceptor寻踪：总结》")])],1)])])])}),[],!1,null,null,null);n.default=a.exports}}]);