(window.webpackJsonp=window.webpackJsonp||[]).push([[71],{735:function(s,a,t){"use strict";t.r(a);var n=t(4),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("div",{staticClass:"language-dockerfile line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" phusion/baseimage\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("MAINTAINER")]),s._v(" Matthew Rayner <hello@rayner.io"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[t("code",[s._v("FROM")]),s._v("基于哪个docker image")]),s._v(" "),t("p",[t("code",[s._v("MAINTAINER")]),s._v("维护者信息")]),s._v(" "),t("div",{staticClass:"language-dockerfile line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" REFRESHED_AT 2019"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("03"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("12\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" DOCKER_USER_ID 501\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" DOCKER_USER_GID 20\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" BOOT2DOCKER_ID 1000\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" BOOT2DOCKER_GID 50\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" PHPMYADMIN_VERSION=4.8.5\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("p",[t("code",[s._v("ENV")]),s._v("是在"),t("strong",[s._v("镜像系统")]),s._v("内定义变量的指令。通过"),t("code",[s._v("ENV")]),s._v("定义的环境变量，会永久的保存到该镜像创建的任何容器中，可以被后面的所有指令中使用，包括后面运行用"),t("code",[s._v("ADD")]),s._v("引入到系统的外部sh文件也能看得见这个")]),s._v(" "),t("div",{staticClass:"language-dockerfile line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Tweaks to give Apache/PHP write permissions to the app")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" usermod "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("u $"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("BOOT2DOCKER_ID"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" www"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("data && \\\n    usermod "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("G staff www"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("data && \\\n    useradd "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("r mysql && \\\n    usermod "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("G staff mysql\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" groupmod "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("g $(($BOOT2DOCKER_GID + 10000)) $(getent group $BOOT2DOCKER_GID "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),s._v(" cut "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("d"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("f1)\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" groupmod "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("g $"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("BOOT2DOCKER_GID"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" staff\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("p",[t("code",[s._v("RUN")]),s._v("在容器内运行指令，"),t("code",[s._v("$XXX")]),s._v("和"),t("code",[s._v("${XXX}")]),s._v("是调用"),t("code",[s._v("ENV")]),s._v("系统变量的方式")]),s._v(" "),t("div",{staticClass:"language-dockerfile line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Install packages")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" DEBIAN_FRONTEND noninteractive\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" add"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("apt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("repository "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("y ppa"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("ondrej/php && \\\n  apt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("key adv "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("keyserver keyserver.ubuntu.com "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("recv"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("keys 4F4EA0AAE5267A6C && \\\n  apt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("get update && \\\n  apt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("get "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("y upgrade && \\\n  apt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("get "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("y install supervisor wget git apache2 php"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("xdebug libapache2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("mod"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("php mysql"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("server php"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("mysql pwgen php"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("apcu php7.1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("mcrypt php"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("gd php"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("xml php"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("mbstring php"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("gettext zip unzip php"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("zip curl php"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("curl && \\\n  apt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("get "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("y autoremove && \\\n  echo "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ServerName localhost"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v(" /etc/apache2/apache2.conf\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# needed for phpMyAdmin")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" ln "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("s /etc/php/7.1/mods"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("available/mcrypt.ini /etc/php/7.3/mods"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("available/ && \\\n  phpenmod mcrypt\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br")])]),t("p",[s._v("这是在装php")]),s._v(" "),t("div",{staticClass:"language-dockerfile line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Add image configuration and scripts")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ADD")]),s._v(" supporting_files/start"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("apache2.sh /start"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("apache2.sh\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ADD")]),s._v(" supporting_files/start"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("mysqld.sh /start"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("mysqld.sh\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ADD")]),s._v(" supporting_files/run.sh /run.sh\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[t("code",[s._v("ADD [把哪个文件] [放到哪]")]),s._v("是把外部文件放进容器中，这里直接放了几个启动脚本在根目录")]),s._v(" "),t("div",{staticClass:"language-dockerfile line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" chmod 755 /*.sh\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("管理员模式运行刚才放进去那几个启动脚本")]),s._v(" "),t("div",{staticClass:"language-dockerfile line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ADD")]),s._v(" supporting_files/supervisord"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("apache2.conf /etc/supervisor/conf.d/supervisord"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("apache2.conf\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ADD")]),s._v(" supporting_files/supervisord"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("mysqld.conf /etc/supervisor/conf.d/supervisord"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("mysqld.conf\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("放supervisord的配置文件。supervisord是一个nb的进程管理软件")]),s._v(" "),t("p",[s._v("这些.conf文件里面都写了启动命令的，然后run.sh脚本里面没有明显调用这几个文件而是只有一个"),t("code",[s._v("exec supervisord -n")]),s._v("。supervisord启动时会自动搜索配置文件")]),s._v(" "),t("div",{staticClass:"language-dockerfile line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ADD")]),s._v(" supporting_files/mysqld_innodb.cnf /etc/mysql/conf.d/mysqld_innodb.cnf\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("放mysqld的配置文件")]),s._v(" "),t("div",{staticClass:"language-dockerfile line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Allow mysql to bind on 0.0.0.0")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" sed "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("i "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"s/.*bind-address.*/bind-address = 0.0.0.0/"')]),s._v(" /etc/mysql/my.cnf\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("改MySQL的绑定端口使能外部连接")]),s._v(" "),t("div",{staticClass:"language-dockerfile line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Set PHP timezones to Europe/London")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" sed "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("i "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"s/;date.timezone =/date.timezone = Europe\\/London/g"')]),s._v(" /etc/php/7.3/apache2/php.ini\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" sed "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("i "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"s/;date.timezone =/date.timezone = Europe\\/London/g"')]),s._v(" /etc/php/7.3/cli/php.ini\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("设php时区")]),s._v(" "),t("div",{staticClass:"language-dockerfile line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Remove pre-installed database")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" rm "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("rf /var/lib/mysql\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Add MySQL utils")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ADD")]),s._v(" supporting_files/create_mysql_users.sh /create_mysql_users.sh\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" chmod 755 /*.sh\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[s._v("又整了一个创建MySQL用户的脚本")]),s._v(" "),t("div",{staticClass:"language-dockerfile line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Add phpmyadmin")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" wget "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("O /tmp/phpmyadmin.tar.gz https"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("//files.phpmyadmin.net/phpMyAdmin/$"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("PHPMYADMIN_VERSION"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("/phpMyAdmin"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("$"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("PHPMYADMIN_VERSION"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("all"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("languages.tar.gz\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" tar xfvz /tmp/phpmyadmin.tar.gz "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("C /var/www\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" ln "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("s /var/www/phpMyAdmin"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("$"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("PHPMYADMIN_VERSION"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("all"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("languages /var/www/phpmyadmin\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" mv /var/www/phpmyadmin/config.sample.inc.php /var/www/phpmyadmin/config.inc.php\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("装phpmyadmin")]),s._v(" "),t("div",{staticClass:"language-dockerfile line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Add composer")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" php "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("r "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"copy('https://getcomposer.org/installer', 'composer-setup.php');\"")]),s._v(" && \\\n    php composer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("setup.php && \\\n    php "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("r "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"unlink('composer-setup.php');\"")]),s._v(" && \\\n    mv composer.phar /usr/local/bin/composer\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("不知道干嘛的，反之就是在容器里面又run了点php有关的东西")]),s._v(" "),t("div",{staticClass:"language-dockerfile line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" MYSQL_PASS"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("$(pwgen "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("s 12 1)\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("这一条没找到引用在哪里")]),s._v(" "),t("div",{staticClass:"language-dockerfile line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# config to enable .htaccess")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ADD")]),s._v(" supporting_files/apache_default /etc/apache2/sites"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("available/000"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("default.conf\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" a2enmod rewrite\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("改apache的配置文件")]),s._v(" "),t("div",{staticClass:"language-dockerfile line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Configure /app folder with sample app")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" mkdir "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("p /app && rm "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("fr /var/www/html && ln "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("s /app /var/www/html\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ADD")]),s._v(" app/ /app\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("创建/app目录，然后链接到/var/www/html下面，然后把外部文件中的app/文件夹里面的文件（那个欢迎界面index.php）加进去")]),s._v(" "),t("div",{staticClass:"language-dockerfile line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#Environment variables to configure php")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" PHP_UPLOAD_MAX_FILESIZE 10M\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" PHP_POST_MAX_SIZE 10M\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("这两个在run.sh里面用到了，看字面意思是POST和上传文件时的大小限制")]),s._v(" "),t("div",{staticClass:"language-dockerfile line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Add volumes for the app and MySql")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("VOLUME")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/etc/mysql"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/var/lib/mysql"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/app"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[t("code",[s._v("VOLUME [文件夹A,文件夹B,...]")]),s._v("把指定的文件夹暴露给外部挂载，有了这个指令就可以在"),t("code",[s._v("docker run")]),s._v("的时候用"),t("code",[s._v("-v")]),s._v("挂载外部目录了。没暴露的文件夹不能挂载")]),s._v(" "),t("div",{staticClass:"language-dockerfile line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXPOSE")]),s._v(" 80 3306\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[t("code",[s._v("EXPOSE 端口A 端口B ...")]),s._v("把指定的端口暴露给外部映射，有了这个指令就可以在"),t("code",[s._v("docker run")]),s._v("的时候用"),t("code",[s._v("-p")]),s._v("指定端口映射了。没暴露的端口不能映射")]),s._v(" "),t("div",{staticClass:"language-dockerfile line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CMD")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/run.sh"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("又运行了一下方才"),t("code",[s._v("ADD")]),s._v("进去的一个sh脚本")]),s._v(" "),t("p",[t("code",[s._v("CMD")]),s._v("是在容器内的控制台运行指令，这个会被"),t("code",[s._v("docker run [CONTAIN_ID] [指令]")]),s._v("中的[指令]覆盖")])])}),[],!1,null,null,null);a.default=e.exports}}]);