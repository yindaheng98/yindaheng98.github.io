(window.webpackJsonp=window.webpackJsonp||[]).push([[89],{754:function(s,e,a){"use strict";a.r(e);var t=a(4),n=Object(t.a)({},(function(){var s=this,e=s.$createElement,a=s._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("blockquote",[a("p",[s._v("Kubernetes 支持多个"),a("strong",[s._v("虚拟集群")]),s._v("，它们底层依赖于同一个物理集群。 这些虚拟集群被称为"),a("strong",[s._v("命名空间（namespace）")]),s._v("。")]),s._v(" "),a("p",[s._v("命名空间"),a("strong",[s._v("适用于存在很多跨多个团队或项目的用户的场景")]),s._v("。对于只有几到几十个用户的集群，根本不需要创建或考虑命名空间。当需要名称空间提供的功能时，请开始使用它们。")]),s._v(" "),a("p",[s._v("命名空间"),a("strong",[s._v("为名称提供了一个范围")]),s._v("。资源的名称需要在命名空间内是唯一的，但不能跨命名空间。命名空间不能相互嵌套，每个 Kubernetes 资源只能在一个命名空间中。")]),s._v(" "),a("p",[s._v("命名空间是"),a("strong",[s._v("在多个用户之间划分集群资源的一种方法（通过资源配额）")]),s._v("。")]),s._v(" "),a("p",[s._v("在 Kubernetes 未来版本中，相同命名空间中的对象默认将具有相同的访问控制策略。")]),s._v(" "),a("p",[s._v("不需要使用多个命名空间来分隔轻微不同的资源，例如同一软件的不同版本："),a("strong",[s._v("使用 labels 来区分同一命名空间中的不同资源")]),s._v("。")])]),s._v(" "),a("h2",{attrs:{id:"namespaces的使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#namespaces的使用"}},[s._v("#")]),s._v(" Namespaces的使用")]),s._v(" "),a("h3",{attrs:{id:"查看名称空间"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看名称空间"}},[s._v("#")]),s._v(" 查看名称空间")]),s._v(" "),a("h4",{attrs:{id:"查看所有名称空间"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看所有名称空间"}},[s._v("#")]),s._v(" 查看所有名称空间")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ kubectl get namespaces\nNAME          STATUS    AGE\ndefault       Active    11d\nkube-system   Active    11d\nkube-public   Active    11d\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("上面这三个名称空间是K8S的初始化名称空间。")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("default")]),s._v("：用户创建的未指定名称空间的Pod统一默认归入此名称空间")]),s._v(" "),a("li",[a("code",[s._v("kube-system")]),s._v("：K8S创建的对象统一归入此名称空间")]),s._v(" "),a("li",[a("code",[s._v("kube-public")]),s._v("：该命名空间被自动创建，并且对所有用户（包括未授权用户）都是可读的。该命名空间一般留作集群使用，用于存放一些始终可以被整个集群访问、读取的公共资源。This namespace is "),a("strong",[s._v("only a convention")]),s._v(", not a requirement.")])]),s._v(" "),a("h4",{attrs:{id:"查看某个名称空间"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看某个名称空间"}},[s._v("#")]),s._v(" 查看某个名称空间")]),s._v(" "),a("p",[s._v("简略信息：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ kubectl get namespaces "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("name"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("详细信息：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ kubectl describe namespaces "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("name"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\nName:           default\nLabels:         "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\nAnnotations:    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\nStatus:         Active\n\nNo resource quota.\n\nResource Limits\n Type       Resource    Min Max Default\n ----               --------    --- --- ---\n Container          cpu         -   -   100m\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("h3",{attrs:{id:"创建名称空间"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建名称空间"}},[s._v("#")]),s._v(" 创建名称空间")]),s._v(" "),a("blockquote",[a("p",[s._v("The name of your namespace "),a("strong",[s._v("must be a valid DNS label")]),s._v(".")])]),s._v(" "),a("h4",{attrs:{id:"用文件创建"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#用文件创建"}},[s._v("#")]),s._v(" 用文件创建")]),s._v(" "),a("p",[s._v("创建文件"),a("code",[s._v("my-namespace.yaml")]),s._v("：")]),s._v(" "),a("div",{staticClass:"language-yml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Namespace\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" <insert"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("namespace"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("here"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("然后创建：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl create -f ./my-namespace.yaml\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("注：还有一个可选的字段"),a("code",[s._v("finalizers")]),s._v("，该字段用于指定一些finalizer监听该Namespace的删除操作，这些finalizer负责释放Namespace中的资源。如果你指定了不存在的"),a("code",[s._v("finalizers")]),s._v("，该命名空间会被创建，但删除时会卡在"),a("code",[s._v("Terminating")]),s._v("状态。")]),s._v(" "),a("h4",{attrs:{id:"用指令创建"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#用指令创建"}},[s._v("#")]),s._v(" 用指令创建")]),s._v(" "),a("p",[s._v("直接：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl create namespace "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("insert-namespace-name-here"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"删除名称空间"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#删除名称空间"}},[s._v("#")]),s._v(" 删除名称空间")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl delete namespaces "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("insert-some-namespace-name"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("删除过程是异步的，立即执行"),a("code",[s._v("kubectl get namespaces")]),s._v("你可以看到namespaces并没有被删除而是进入"),a("code",[s._v("Terminating")]),s._v("状态，过一会才会真正删除。")]),s._v(" "),a("h2",{attrs:{id:"命名空间的正确使用方法（案例）"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#命名空间的正确使用方法（案例）"}},[s._v("#")]),s._v(" 命名空间的正确使用方法（案例）")]),s._v(" "),a("blockquote",[a("p",[s._v("在某组织使用共享的 Kubernetes 集群进行开发和生产的场景中：")]),s._v(" "),a("p",[s._v("开发团队希望在集群中维护一个空间，以便他们可以查看"),a("strong",[s._v("用于构建和运行其应用程序的")]),s._v(" Pods、Services 和 Deployments 列表。在这个空间里，Kubernetes "),a("strong",[s._v("资源被自由地加入或移除")]),s._v("，对谁能够或不能修改资源的"),a("strong",[s._v("限制被放宽")]),s._v("，以"),a("strong",[s._v("实现敏捷开发")]),s._v("。")]),s._v(" "),a("p",[s._v("运维团队希望在集群中维护一个空间，以便他们可以"),a("strong",[s._v("强制实施一些严格的规程")]),s._v("，"),a("strong",[s._v("对谁可以或不可以操作运行生产站点的")]),s._v(" Pods、Services 和 Deployments 集合进行控制。")])]),s._v(" "),a("p",[s._v("实现思路：划分为两个命名空间 - development 和 production，development用于开发、production用于生产。")]),s._v(" "),a("p",[s._v("development命名空间定义"),a("code",[s._v("development.yml")]),s._v("：")]),s._v(" "),a("div",{staticClass:"language-yml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Namespace\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" development\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" development\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("development命名空间定义"),a("code",[s._v("production.yml")]),s._v("：")]),s._v(" "),a("div",{staticClass:"language-yml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Namespace\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" production\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" production\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("创建：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ kubectl create -f ./development.yml\n$ kubectl create -f ./production.yml\n$ kubectl get namespaces --show-labels\nNAME          STATUS    AGE       LABELS\ndefault       Active    32m       "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\ndevelopment   Active    29s       "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("development\nproduction    Active    23s       "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("production\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("定义为名称空间定义context，包括所在集群位置、用户名等：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl config set-context dev --namespace"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("development --cluster"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("集群名称"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" --user"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("用户名称"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\nkubectl config set-context prod --namespace"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("production --cluster"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("集群名称"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" --user"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("用户名称"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("切换到"),a("code",[s._v("development")]),s._v("命名空间进行操作：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ kubectl config use-context dev\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("此后，除切换名称空间外的所有"),a("code",[s._v("kubectl")]),s._v("指令都限定于在"),a("code",[s._v("development")]),s._v("命名空间中，不同名称空间内的内容互不可见，用户可以随意操作而不必担心影响到"),a("code",[s._v("production")]),s._v("命名空间中的内容。")]),s._v(" "),a("h2",{attrs:{id:"理解使用命名空间的动机"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#理解使用命名空间的动机"}},[s._v("#")]),s._v(" 理解使用命名空间的动机")]),s._v(" "),a("blockquote",[a("p",[s._v("单个集群应该能满足多个用户及用户组的需求（以下称为 “用户社区”）。")]),s._v(" "),a("p",[s._v("Kubernetes 命名空间 帮助不同的项目、团队或客户去共享 Kubernetes 集群。\n名字空间通过以下方式实现这点：")]),s._v(" "),a("ul",[a("li",[s._v("为名字设置作用域")]),s._v(" "),a("li",[s._v("为集群中的部分资源关联鉴权和策略的机制")])]),s._v(" "),a("p",[s._v("使用多个命名空间是可选的。")]),s._v(" "),a("p",[s._v("每个用户社区都希望能够与其他社区隔离开展工作。")]),s._v(" "),a("p",[s._v("每个用户社区都有:")]),s._v(" "),a("ol",[a("li",[s._v("资源（pods, services, replication controllers, 等等）")]),s._v(" "),a("li",[s._v("策略（谁能或不能在他们的社区里执行操作）")]),s._v(" "),a("li",[s._v("约束（该社区允许多少配额，等等）")]),s._v(" "),a("li",[s._v("集群运营者可以为每个唯一用户社区创建命名空间。")])]),s._v(" "),a("p",[s._v("命名空间为下列内容提供唯一的作用域：")]),s._v(" "),a("ol",[a("li",[s._v("命名资源（避免基本的命名冲突）")]),s._v(" "),a("li",[s._v("将管理权限委派给可信用户")]),s._v(" "),a("li",[s._v("限制社区资源消耗的能力")])]),s._v(" "),a("p",[s._v("用例包括:")]),s._v(" "),a("ol",[a("li",[s._v("作为集群运营者, 我希望能在单个集群上支持多个用户社区。")]),s._v(" "),a("li",[s._v("作为集群运营者，我希望将集群分区的权限委派给这些社区中的受信任用户。")]),s._v(" "),a("li",[s._v("作为集群运营者，我希望能限定每个用户社区可使用的资源量，以限制对使用同一集群的其他用户社区的影响。")]),s._v(" "),a("li",[s._v("作为群集用户，我希望与我的用户社区相关的资源进行交互，而与其他用户社区在该集群上执行的操作无关。")])])])])}),[],!1,null,null,null);e.default=n.exports}}]);